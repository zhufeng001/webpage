<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>iptables 学习总结 收藏_Cisco技术 无忧网客联盟</title>
<meta name="keywords" content="收藏,总结,学习,iptables,-A,-j,IFACE," />
<meta name="description" content="iptables学习总结(一) 收藏 1、显示当前iptables状态(-n表示以数字形式显示IP地址和端口，默认会自动对ip地址进行解析为机器名或网络名，这需要花费不少时间，若不使用-n选项，则iptables -L常会出现停顿现象) #iptables -L -n 当然，也可以直接使用 #iptabl" />
<link href="/templets/style/dedecms.css" rel="stylesheet" media="screen" type="text/css" />
<script language="javascript" type="text/javascript" src="/include/dedeajax2.js"></script>
<script language="javascript" type="text/javascript">
<!--
function CheckLogin(){
	  var taget_obj = document.getElementById('_ajax_feedback');
	  myajax = new DedeAjax(taget_obj,false,false,'','','');
	  myajax.SendGet2("/member/ajax_feedback.php");
	  DedeXHTTP = null;
}
function postBadGood(ftype,fid)
{
	var taget_obj = document.getElementById(ftype+fid);
	var saveid = GetCookie('badgoodid');
	if(saveid != null)
	{
		var saveids = saveid.split(',');
		var hasid = false;
		saveid = '';
		j = 1;
		for(i=saveids.length-1;i>=0;i--)
		{
			if(saveids[i]==fid && hasid) continue;
			else {
				if(saveids[i]==fid && !hasid) hasid = true;
				saveid += (saveid=='' ? saveids[i] : ','+saveids[i]);
				j++;
				if(j==10 && hasid) break;
				if(j==9 && !hasid) break;
			}
		}
		if(hasid) { alert('您刚才已表决过了喔！'); return false;}
		else saveid += ','+fid;
		SetCookie('badgoodid',saveid,1);
	}
	else
	{
		SetCookie('badgoodid',fid,1);
	}
	myajax = new DedeAjax(taget_obj,false,false,'','','');
	myajax.SendGet2("/plus/feedback.php?aid="+fid+"&action="+ftype+"&fid="+fid);
}
function postDigg(ftype,aid)
{
	var taget_obj = document.getElementById('newdigg');
	var saveid = GetCookie('diggid');
	if(saveid != null)
	{
		var saveids = saveid.split(',');
		var hasid = false;
		saveid = '';
		j = 1;
		for(i=saveids.length-1;i>=0;i--)
		{
			if(saveids[i]==aid && hasid) continue;
			else {
				if(saveids[i]==aid && !hasid) hasid = true;
				saveid += (saveid=='' ? saveids[i] : ','+saveids[i]);
				j++;
				if(j==20 && hasid) break;
				if(j==19 && !hasid) break;
			}
		}
		if(hasid) { alert("您已经顶过该帖，请不要重复顶帖 ！"); return; }
		else saveid += ','+aid;
		SetCookie('diggid',saveid,1);
	}
	else
	{
		SetCookie('diggid',aid,1);
	}
	myajax = new DedeAjax(taget_obj,false,false,'','','');
	var url = "/plus/digg_ajax.php?action="+ftype+"&id="+aid;
	myajax.SendGet2(url);
}
function getDigg(aid)
{
	var taget_obj = document.getElementById('newdigg');
	myajax = new DedeAjax(taget_obj,false,false,'','','');
	myajax.SendGet2("/plus/digg_ajax.php?id="+aid);
	DedeXHTTP = null;
}
-->
</script>
</head>
<body class="articleview">
<div class="header">
	<div class="top w960 center">
      <div class="title">
        <h1> <a href="http://www.net527.cn">Cisco技术 无忧网客联盟</a> </h1>
      </div>
      <div class="banner"><script src='/plus/ad_js.php?aid=1' language='javascript'></script></div>
      <div class="rlink">
        <ul>
          <li class="r1"><a href="/member">会员中心</a></li>
          <li class="r2"><a href="/tags.php">TAG标签</a></li>
          <li class="r3"><a href="/data/sitemap.html">网站地图</a></li>
          <li class="r4"><a href="/data/rssmap.html">RSS订阅</a></li>
        </ul>
      </div>
	</div><!-- //top -->
	<!-- //菜单 -->
	<div class="module blue mT10 wrapper w963">
  	<div class="top">
    	<div class="t_l"></div>
    	<div class="t_r"></div>
    	<!-- //如果不使用currentstyle，可以在channel标签加入 cacheid='channeltoplist' 属性提升性能 -->
    <div id="navMenu">
    	<ul>
      	<li><a href='/'>主页</a></li>
      	
      	<li><a href='/a/ITyejiepinglun/' >IT业界评论</a></li>
      	
      	<li><a href='/a/ITrenzheng/'  rel='dropmenu2'>IT认证</a></li>
      	
      	<li><a href='/a/Ciscomoniqi/'  rel='dropmenu10'>Cisco模拟器</a></li>
      	
      	<li><a href='/a/luyoujiaohuan/'  rel='dropmenu13'>路由交换</a></li>
      	<li class='hover'><a href='/a/anquan/'  rel='dropmenu19'>安全</a></li>
      	<li><a href='/a/caozuoxitong/'  rel='dropmenu25'>操作系统</a></li>
      	
      	<li><a href='http://www.net527.cn/special/' >专题</a></li>
      	
      	<li><a href='/ziliaoxiazai/'  rel='dropmenu171'>资料下载</a></li>
      	
      	<li><a href='/ziliaoxiazai/' >资料下载</a></li>
      	
      	<li><a href='/yunjisuan/' >云计算</a></li>
      	
    	</ul>
    </div>	
    <div class="search">
      <form action="/plus/search.php" name="formsearch">
        <div class="form">
          <h4>搜索</h4>
           <input type="hidden" name="kwtype" value="0" />
           <input name="keyword" type="text" class="search-keyword" id="search-keyword" />
           <select name="searchtype" class="search-option" id="search-option">
               <option value="titlekeyword" selected='1'>智能模糊搜索</option>
               <option value="title">仅搜索标题</option>
           </select>
          <button type="submit" class="search-submit">搜索</button>
        </div>
        </form>
        <div class="tags">
          <h4>热门标签</h4>
          <ul>
          <li><a href='/tags.php?/%B5%F7%B6%C8/'>调度</a></li>
          <li><a href='/tags.php?/clean/'>clean</a></li>
          <li><a href='/tags.php?/%B5%E7%BB%B0/'>电话</a></li>
          <li><a href='/tags.php?/enable/'>enable</a></li>
          <li><a href='/tags.php?/inspect/'>inspect</a></li>
          <li><a href='/tags.php?/metric/'>metric</a></li>
          <li><a href='/tags.php?/log/'>log</a></li>
          <li><a href='/tags.php?/ASDM/'>ASDM</a></li>
          
          </ul>
        </div>
    </div><!-- //search -->
		</div>
	</div>
</div><!-- //header -->

<!-- /header -->
<div class="w960 center clear"><script src='/plus/ad_js.php?aid=19' language='javascript'></script></div>
<div class="channel-nav w960 center clear">
	<div class='sonnav'>
	
		<span><a href='/a/anquan/Ciscoanquan/'>Cisco安全</a></span>
		<span><a href='/a/anquan/Juniperanquan/'>Juniper安全</a></span>
		<span><a href='/a/anquan/huaweianquan/'>华为安全</a></span><span><a href='/a/anquan/kaiyuanfanghuoqiang/' class='thisclass'>开源防火墙</a></span>
		<span><a href='/a/anquan/dianzishu/'>电子书</a></span>
		<span><a href='/a/anquan/xitonganquan/'>系统安全</a></span>
	</div>
	<span class="back">
		<a href="/">返回首页</a>
	</span>
</div><!-- /channel-nav -->

<div class="w960 center clear mt1">
	<div class="pleft">
		<div class="place">
			<strong>当前位置:</strong> <a href='http://www.net527.cn/'>无忧网客联盟</a> > <a href='/a/anquan/'>安全</a> > <a href='/a/anquan/kaiyuanfanghuoqiang/'>开源防火墙</a> > 
		</div><!-- /place -->
		<div class="viewbox">
			<div class="title">
				<h2>iptables 学习总结 收藏</h2>
			</div><!-- /title -->
			<div class="info">
				<small>时间:</small>2010-02-25 13:11<small>来源:</small>未知 <small>作者:</small>admin <small>点击:</small><script src="/plus/count.php?view=yes&aid=6428&mid=1" type='text/javascript' language="javascript"></script>次</div><!-- /info -->

            	<div class="intro">iptables学习总结(一) 收藏 1、显示当前iptables状态(-n表示以数字形式显示IP地址和端口，默认会自动对ip地址进行解析为机器名或网络名，这需要花费不少时间，若不使用-n选项，则iptables -L常会出现停顿现象) #iptables -L -n 当然，也可以直接使用 #iptabl</div>
			<div class="intro">

			<table width='100%'>
				<tr><td><SPAN style="FLOAT: right">
<script src='/plus/ad_js.php?aid=6' language='javascript'></script> 
</SPAN><p><a href='http://www.net527.cn/a/anquan/'><u>iptables</u></a><a href='http://www.net527.cn/a/ITrenzheng/'><u>学习</u></a><a href='http://www.net527.cn/a/luyoujiaohuan/'><u>总结</u></a>(一) 收藏 <br />
1、显示当前iptables状态(-n表示以数字形式显示IP地址和端口，默认会自动对ip地址进行解析为机器名或网络名，这需要花费不少时间，若不使用-n选项，则iptables -L常会出现停顿现象)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  #iptables -L -n</p>
<p>&nbsp;&nbsp;&nbsp;  当然，也可以直接使用</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  #iptables-save</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  命令，也将显示目前正在使用的iptables，显示结果只是格式不同而已。</p>
<p>2、添加或修改iptables后，建议对iptables进行保存.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  #iptables-save &gt; iptables-script</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  重新加载iptables规则，使用命令：</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  #iptables-restore iptables-script</p>
<p>3、若要在iptables重启后保持修改后的状态，则需要执行下面的命令</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;  #service iptables save</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;  现在执行 service iptables restart命令，在使用 iptables -L -n，你会发现结果就是你之前修改后的结果，而不再是系统默认的iptables规则了。</p>
<p>4、iptables -[command] chain，command选项解释如下：</p>
<p>--flush&nbsp;&nbsp;  -F [chain]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Delete all rules in  chain or all chains //删除所有链中的所有规则（包括用户自定义链）<br />
--zero&nbsp;&nbsp;&nbsp;  -Z [chain]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Zero counters in chain or all chains  //把所有链中的规则计数器清零（不知道这样翻译对不对:)）<br />
--new&nbsp;&nbsp;&nbsp;&nbsp;  -N chain&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Create a new user-defined chain //创建一个新的用户自定义链<br />
--delete-chain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  -X [chain]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Delete a user-defined chain  //删除一个用户自定义链<br />
--policy  -P chain target <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Change policy on chain to target //设置链的默认政策<br />
--rename-chain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  -E old-chain new-chain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Change chain name, (moving any references) //重命名链名（用户自定义链）</p>
<p>5、一般在定义任何规则之前，需要执行以下命令：</p>
<p>#iptables -F  #删除所有规则<br />
#iptables -Z  #删除所有规则<br />
#iptables -X  #删除自定义链<br />
#iptables -t -nat -F #删除nat表里所有规则</p>
<p><br />
iptables学习研究(二) 收藏 <br />
下面给出简单的iptables规则定义的步骤与方法:</p>
<p>第一步:清楚所有以定义的规则和用户自定义规则</p>
<p>#iptables -F <br />
#iptables -X <br />
#iptables -Z</p>
<p>第二步:设置默认政策,这里为了安全和方面控制,把所有默认政策设置为丢弃(DROP)</p>
<p>#iptables -P INPUT DROP <br />
#iptables -P FORWARD DROP <br />
#iptables -P OUTPUT DROP</p>
<p>第三步：禁止ping服务器</p>
<p>#/bin/echo &quot;1&quot; &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</p>
<p>第四步：禁止ip转发</p>
<p>#/bin/echo &quot;0&quot; &gt; /proc/sys/net/ipv4/ip_forward</p>
<p>第五步：允许本地环路</p>
<p>#iptables -A INPUT -i lo -j ACCEPT <br />
#iptables -A OUTPUT -o lo -j ACCEPT</p>
<p>第六步：确保tcp连接是合法的syn数据包</p>
<p>#iptables -A INPUT -i eth0 -p tcp ! --syn -m state --state NEW -j DROP</p>
<p>第七步：打开ssh端口(即22端口)<br />
#iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT <br />
#iptables -A OUTPUT -o eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p>第八步：打开ftp端口(即21端口)</p>
<p>#iptables -A INPUT -i eth0 -p tcp --sport 21 -m state --state ESTABLISHED -j ACCEPT<br />
#iptables -A OUTPUT -o eth0 -p tcp --dport 21 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p>第九步：打开www端口（即80端口）</p>
<p>#iptables -A INPUT -i eth0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT <br />
#iptables -A OUTPUT -o eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p>第十步：保存</p>
<p>#iptables-save &gt; iptables-script<br />
#iptables-restore iptables-script</p>
<p>或者</p>
<p>#service iptables save</p>
<p><br />
iptables学习研究三(limit,--limit-burst) 收藏 <br />
iptables --limit --limit-burst 使用研究</p>
<p>1、限制特定包传入速度<br />
2、限制特定端口传入频率<br />
3、使用--limit限制ping的一个例子<br />
4、用户自定义使用链<br />
5、防范SYN-Flood碎片攻击</p>
<p>1、限制特定包传入速度<br />
参数 -m limit --limit <br />
范例 iptables -A INPUT -m limit --limit 3/hour <br />
说明 用来比对某段时间内封包的平均流量，上面的例子是用来比对：每小时平均流量是否超过一次 3 个封包。 除了每小时平均 <br />
次外，也可以每秒钟、每分钟或每天平均一次，默认值为每小时平均一次，参数如后： /second、 /minute、/day。 除了进行封 <br />
数量的比对外，设定这个参数也会在条件达成时，暂停封包的比对动作，以避免因骇客使用洪水攻击法，导致服务被阻断。</p>
<p>2、限制特定包瞬间传入的峰值<br />
参数 --limit-burst <br />
范例 iptables -A INPUT -m limit --limit-burst 5 <br />
说明 用来比对瞬间大量封包的数量，上面的例子是用来比对一次同时涌入的封包是否超过 5 个（这是默认值），超过此上限的封 <br />
将被直接丢弃。使用效果同上。</p>
<p><br />
3、使用--limit限制ping的一个例子</p>
<p>限制同时响应的 ping (echo-request) 的连接数<br />
限制每分只接受一 icmp echo-request 封包（注意：当已接受1个icmp echo-request 封包后，<br />
iptables将重新统计接受之后的一秒内接受的icmp echo-request 封包的个数，此刻为0个，所以它会继续接受icmp echo-request包，<br />
出现的结果是你在1分钟时间内将看到很多</p>
<p>Reply from 192.168.0.111: bytes=32 time&lt;1ms TTL=64<br />
Reply from 192.168.0.111: bytes=32 time&lt;1ms TTL=64<br />
Reply from 192.168.0.111: bytes=32 time&lt;1ms TTL=64<br />
Reply from 192.168.0.111: bytes=32 time&lt;1ms TTL=64<br />
Reply from 192.168.0.111: bytes=32 time&lt;1ms TTL=64<br />
Reply from 192.168.0.111: bytes=32 time&lt;1ms TTL=64<br />
Reply from 192.168.0.111: bytes=32 time&lt;1ms TTL=64<br />
Reply from 192.168.0.111: bytes=32 time&lt;1ms TTL=64</p>
<p>响应结果，若你同时开好几个ping窗口，你会发现任一时刻只有一个会有响应//--limit 1/m 所限制）</p>
<p>#iptables -A INPUT -p icmp --icmp-type echo-request -m limit --limit 1/m --limit-burst 1 -j ACCEPT<br />
#iptables -A INPUT -p icmp --icmp-type echo-request -j DROP</p>
<p>--limit 1/s 表示每秒一次; 1/m 则为每分钟一次<br />
--limit-burst 表示允许触发 limit 限制的最大次数 (预设 5)</p>
<p>4、用户自定义使用链</p>
<p>上面例子的另一种实现方法：</p>
<p>#iptables -N pinglimit<br />
#iptables -A pinglimit -m limit --limit 1/m --limit-burst 1 -j ACCEPT<br />
#iptables -A pinglimit -j DROP<br />
#iptables -A INPUT -p icmp --icmp-type echo-request -j pinglimit</p>
<p>5、防范 SYN-Flood 碎片攻击</p>
<p>#iptables -N syn-flood<br />
#iptables -A syn-flood -m limit --limit 100/s --limit-burst 150 -j RETURN<br />
#iptables -A syn-flood -j DROP<br />
#iptables -I INPUT -j syn-flood</p>
<p><br />
本文来自CSDN博客，转载请标明出处：<a href="http://blog.csdn.net/fafa211/archive/2008/04/19/2307517.aspx">http://blog.csdn.net/fafa211/archive/2008/04/19/2307517.aspx</a><br />
iptables学习与研究四(使用LOG记录失败日志) 收藏 <br />
通常情况下，iptables的默认政策为DROP，不匹配的数据包将被直接丢弃。但在丢弃之前建议把信息记录下来，以使你了解哪些信息没有通过规则，有时可依此判断是否有人在尝试攻击你的服务器。</p>
<p>下面给出一个用来详细记录未匹配规则的数据包的iptables规则：</p>
<p>#记录下未符合规则的udp数据包，然后丢弃之。</p>
<p>#iptables -A INPUT -i $IFACE -p udp -j LOG --log-prefix &quot;IPTABLES UDP-IN: &quot; <br />
#iptables -A INPUT -i $IFACE -p udp -j DROP <br />
#iptables -A OUTPUT -o $IFACE -p udp -j LOG --log-prefix &quot;IPTABLES UDP-OUT: &quot; <br />
#iptables -A OUTPUT -o $IFACE -p udp -j DROP</p>
<p># 记录下未符合规则的icmp数据包，然后丢弃之。</p>
<p>#iptables -A INPUT -i $IFACE -p icmp -j LOG --log-prefix &quot;IPTABLES ICMP-IN: &quot; <br />
#iptables -A INPUT -i $IFACE -p icmp -j DROP <br />
#iptables -A OUTPUT -o $IFACE -p icmp -j LOG --log-prefix &quot;IPTABLES ICMP-OUT: &quot; <br />
#iptables -A OUTPUT -o $IFACE -p icmp -j DROP</p>
<p># 记录下未符合规则的tcp数据包，然后丢弃之。</p>
<p>iptables -A INPUT -i $IFACE -p tcp -j LOG --log-prefix &quot;IPTABLES TCP-IN: &quot; <br />
iptables -A INPUT -i $IFACE -p tcp -j DROP <br />
iptables -A OUTPUT -o $IFACE -p tcp -j LOG --log-prefix &quot;IPTABLES TCP-OUT: &quot; <br />
iptables -A OUTPUT -o $IFACE -p tcp -j DROP</p>
<p># 记录下其他未符合规则的数据包，然后丢弃之。</p>
<p>iptables -A INPUT -i $IFACE -j LOG --log-prefix &quot;IPTABLES PROTOCOL-X-IN: &quot; <br />
iptables -A INPUT -i $IFACE -j DROP <br />
iptables -A OUTPUT -o $IFACE -j LOG --log-prefix &quot;IPTABLES PROTOCOL-X-OUT: &quot; <br />
iptables -A OUTPUT -o $IFACE -j DROP</p>
<p>加上适当的记录日志前缀，可以方便对日志进行分析。 日志通常记录在/var/log/message文件中。如，可以使用 cat /var/log/message | grep &quot;IPTABLES UDP-IN: &quot; 查找出你需要的日志信息。 当然为了防止日志文件过大，你也可以对日志文件记录进行限制，如可以在-j LOG 命令 前加上-m limit --limit 6/h --limit-burst 5</p>
<p><br />
iptables学习与研究五(一个由James C. Stephens整理的iptables的规则脚本) 收藏 <br />
# <a href="http://www.cs.princeton.edu/%7Ejns/security/iptables/index.html">http://www.cs.princeton.edu/~jns/security/iptables/index.html</a> <br />
# Prepared by James C. Stephens <br />
# (<a href="mailto:jns@gfdl.noaa.gov">jns@gfdl.noaa.gov</a>)</p>
<p>#!/bin/bash <br />
# <br />
# Load appropriate modules.</p>
<p>modprobe ip_tables <br />
modprobe ip_conntrack <br />
modprobe ip_conntrack_ftp</p>
<p># These lines are here in case rules are already in place and the script is ever rerun on the fly. <br />
# We want to remove all rules and pre-exisiting user defined chains and zero the counters <br />
# before we implement new rules.</p>
<p>iptables -F <br />
iptables -X <br />
iptables -Z</p>
<p># Set up a default DROP policy for the built-in chains. <br />
# If we modify and re-run the script mid-session then (because we have a default DROP <br />
# policy), what happens is that there is a small time period when packets are denied until <br />
# the new rules are back in place. There is no period, however small, when packets we <br />
# don't want are allowed.</p>
<p>iptables -P INPUT DROP <br />
iptables -P FORWARD DROP <br />
iptables -P OUTPUT DROP</p>
<p>## =========================================================== <br />
## Some definitions:</p>
<p>NAMESERVER_1=&quot;x.x.x.x&quot; <br />
NAMESERVER_2=&quot;x.x.x.x&quot; <br />
BROADCAST=&quot;x.x.x.255&quot; <br />
LOOPBACK=&quot;127.0.0.0/8&quot; <br />
CLASS_A=&quot;10.0.0.0/8&quot; <br />
CLASS_B=&quot;172.16.0.0/12&quot; <br />
CLASS_C=&quot;192.168.0.0/16&quot; <br />
CLASS_D_MULTICAST=&quot;224.0.0.0/4&quot; <br />
CLASS_E_RESERVED_NET=&quot;240.0.0.0/5&quot; <br />
P_PORTS=&quot;0:1023&quot; <br />
UP_PORTS=&quot;1024:65535&quot; <br />
TR_SRC_PORTS=&quot;32769:65535&quot; <br />
TR_DEST_PORTS=&quot;33434:33523&quot;</p>
<p>## ============================================================ <br />
## Kernel flags <br />
# To dynamically change kernel parameters and variables on the fly you need <br />
# CONFIG_SYSCTL defined in your kernel. I would advise the following: <br />
# Disable response to ping.</p>
<p>/bin/echo &quot;1&quot; &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</p>
<p># Disable response to broadcasts. <br />
# You don't want yourself becoming a Smurf amplifier.</p>
<p>/bin/echo &quot;1&quot; &gt; /proc/sys/net/ipv4/icmp_echo_ignore_broadcasts</p>
<p># Don't accept source routed packets. Attackers can use source routing to generate <br />
# traffic pretending to be from inside your network, but which is routed back along <br />
# the path from which it came, namely outside, so attackers can compromise your <br />
# network. Source routing is rarely used for legitimate purposes.</p>
<p>/bin/echo &quot;0&quot; &gt; /proc/sys/net/ipv4/conf/all/accept_source_route</p>
<p># Disable ICMP redirect acceptance. ICMP redirects can be used to alter your routing <br />
# tables, possibly to a bad end.</p>
<p>/bin/echo &quot;0&quot; &gt; /proc/sys/net/ipv4/conf/all/accept_redirects</p>
<p># Enable bad error message protection.</p>
<p>/bin/echo &quot;1&quot; &gt; /proc/sys/net/ipv4/icmp_ignore_bogus_error_responses</p>
<p># Turn on reverse path filtering. This helps make sure that packets use <br />
# legitimate source addresses, by automatically rejecting incoming packets <br />
# if the routing table entry for their source address doesn't match the network <br />
# interface they're arriving on. This has security advantages because it prevents <br />
# so-called IP spoofing, however it can pose problems if you use asymmetric routing <br />
# (packets from you to a host take a different path than packets from that host to you) <br />
# or if you operate a non-routing host which has several IP addresses on different <br />
# interfaces. (Note - If you turn on IP forwarding, you will also get this).</p>
<p>for interface in /proc/sys/net/ipv4/conf/*/rp_filter; do <br />
/bin/echo &quot;1&quot; &gt; ${interface} <br />
done</p>
<p># Log spoofed packets, source routed packets, redirect packets.</p>
<p>/bin/echo &quot;1&quot; &gt; /proc/sys/net/ipv4/conf/all/log_martians</p>
<p># Make sure that IP forwarding is turned off. We only want this for a multi-homed host.</p>
<p>/bin/echo &quot;0&quot; &gt; /proc/sys/net/ipv4/ip_forward</p>
<p># Note: With connection tracking, all fragments are reassembled before being <br />
# passed to the packet-filtering code so there is no ip_always_defrag switch as there <br />
# was in the 2.2 kernel.</p>
<p>## ============================================================ <br />
# RULES</p>
<p>## LOOPBACK <br />
# Allow unlimited traffic on the loopback interface.</p>
<p>iptables -A INPUT -i lo -j ACCEPT <br />
iptables -A OUTPUT -o lo -j ACCEPT</p>
<p>## SYN-FLOODING PROTECTION <br />
# This rule maximises the rate of incoming connections. In order to do this we divert tcp <br />
# packets with the SYN bit set off to a user-defined chain. Up to limit-burst connections <br />
# can arrive in 1/limit seconds ..... in this case 4 connections in one second. After this, one <br />
# of the burst is regained every second and connections are allowed again. The default limit <br />
# is 3/hour. The default limit burst is 5.</p>
<p>iptables -N syn-flood <br />
iptables -A INPUT -i $IFACE -p tcp --syn -j syn-flood <br />
iptables -A syn-flood -m limit --limit 1/s --limit-burst 4 -j RETURN <br />
iptables -A syn-flood -j DROP</p>
<p>## Make sure NEW tcp connections are SYN packets</p>
<p>iptables -A INPUT -i $IFACE -p tcp ! --syn -m state --state NEW -j DROP</p>
<p>## FRAGMENTS <br />
# I have to say that fragments scare me more than anything. <br />
# Sending lots of non-first fragments was what allowed Jolt2 to effectively &quot;drown&quot; <br />
# Firewall-1. Fragments can be overlapped, and the subsequent interpretation of such <br />
# fragments is very OS-dependent (see this paper for details). <br />
# I am not going to trust any fragments. <br />
# Log fragments just to see if we get any, and deny them too.</p>
<p>iptables -A INPUT -i $IFACE -f -j LOG --log-prefix &quot;IPTABLES FRAGMENTS: &quot; <br />
iptables -A INPUT -i $IFACE -f -j DROP</p>
<p>## SPOOFING <br />
# Most of this anti-spoofing stuff is theoretically not really necessary with the flags we <br />
# have set in the kernel above ........... but you never know there isn't a bug somewhere in <br />
# your IP stack. <br />
# <br />
# Refuse spoofed packets pretending to be from your IP address.</p>
<p>iptables -A INPUT -i $IFACE -s $IPADDR -j DROP</p>
<p># Refuse packets claiming to be from a Class A private network.</p>
<p>iptables -A INPUT -i $IFACE -s $CLASS_A -j DROP</p>
<p># Refuse packets claiming to be from a Class B private network.</p>
<p>iptables -A INPUT -i $IFACE -s $CLASS_B -j DROP</p>
<p># Refuse packets claiming to be from a Class C private network.</p>
<p>iptables -A INPUT -i $IFACE -s $CLASS_C -j DROP</p>
<p># Refuse Class D multicast addresses. Multicast is illegal as a source address.</p>
<p>iptables -A INPUT -i $IFACE -s $CLASS_D_MULTICAST -j DROP</p>
<p># Refuse Class E reserved IP addresses.</p>
<p>iptables -A INPUT -i $IFACE -s $CLASS_E_RESERVED_NET -j DROP</p>
<p># Refuse packets claiming to be to the loopback interface. <br />
# Refusing packets claiming to be to the loopback interface protects against <br />
# source quench, whereby a machine can be told to slow itself down by an icmp source <br />
# quench to the loopback.</p>
<p>iptables -A INPUT -i $IFACE -d $LOOPBACK -j DROP</p>
<p># Refuse broadcast address packets.</p>
<p>iptables -A INPUT -i $IFACE -d $BROADCAST -j DROP</p>
<p>## DNS <br />
# NOTE: DNS uses tcp for zone transfers, for transfers greater than 512 bytes (possible, but unusual), and on certain <br />
# platforms like AIX (I am told), so you might have to add a copy of this rule for tcp if you need it <br />
# Allow UDP packets in for DNS client from nameservers.</p>
<p>iptables -A INPUT -i $IFACE -p udp -s $NAMESERVER_1 --sport 53 -m state --state ESTABLISHED -j ACCEPT <br />
iptables -A INPUT -i $IFACE -p udp -s $NAMESERVER_2 --sport 53 -m state --state ESTABLISHED -j ACCEPT</p>
<p># Allow UDP packets to DNS servers from client.</p>
<p>iptables -A OUTPUT -o $IFACE -p udp -d $NAMESERVER_1 --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p udp -d $NAMESERVER_2 --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p>## SSH <br />
# Allow ssh outbound.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p>## WWW <br />
# Allow www outbound to 80.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p># Allow www outbound to 443.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p>## TELNET <br />
# Allow telnet outbound.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --sport 23 -m state --state ESTABLISHED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p tcp --dport 23 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p>## FTP <br />
# Allow ftp outbound.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --sport 21 -m state --state ESTABLISHED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p tcp --dport 21 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p># Now for the connection tracking part of ftp. This is discussed more completely in my section <br />
# on connection tracking to be found here. <br />
# 1) Active ftp. <br />
# This involves a connection INbound from port 20 on the remote machine, to a local port <br />
# passed over the ftp channel via a PORT command. The ip_conntrack_ftp module recognizes <br />
# the connection as RELATED to the original outgoing connection to port 21 so we don't <br />
# need NEW as a state match.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --sport 20 -m state --state ESTABLISHED,RELATED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p tcp --dport 20 -m state --state ESTABLISHED -j ACCEPT</p>
<p># 2) Passive ftp. <br />
# This involves a connection outbound from a port &gt;1023 on the local machine, to a port &gt;1023 <br />
# on the remote machine previously passed over the ftp channel via a PORT command. The <br />
# ip_conntrack_ftp module recognizes the connection as RELATED to the original outgoing <br />
# connection to port 21 so we don't need NEW as a state match.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --sport $UP_PORTS --dport $UP_PORTS -m state --state ESTABLISHED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p tcp --sport $UP_PORTS --dport $UP_PORTS -m state --state ESTABLISHED,RELATED -j ACCEPT</p>
<p>## SMTP <br />
# Allow smtp outbound.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT <br />
iptables -A OUTPUT -o $IFACE -p tcp --dport 25 -m state --state NEW,ESTABLISHED -j ACCEPT</p>
<p>## AUTH server <br />
# Reject ident probes with a tcp reset. <br />
# I need to do this for a broken mailhost that won't accept my mail if I just drop its ident probe.</p>
<p>iptables -A INPUT -i $IFACE -p tcp --dport 113 -j REJECT --reject-with tcp-reset</p>
<p>## TRACEROUTE <br />
# Outgoing traceroute anywhere. <br />
# The reply to a traceroute is an icmp time-exceeded which is dealt with by the next rule.</p>
<p>iptables -A OUTPUT -o $IFACE -p udp --sport $TR_SRC_PORTS --dport $TR_DEST_PORTS -m state --state NEW -j ACCEPT</p>
<p># ICMP <br />
# We accept icmp in if it is &quot;related&quot; to other connections (e.g a time exceeded (11) <br />
# from a traceroute) or it is part of an &quot;established&quot; connection (e.g. an echo reply (0) <br />
# from an echo-request (8)).</p>
<p>iptables -A INPUT -i $IFACE -p icmp -m state --state ESTABLISHED,RELATED -j ACCEPT</p>
<p># We always allow icmp out.</p>
<p>iptables -A OUTPUT -o $IFACE -p icmp -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</p>
<p>## LOGGING <br />
# You don't have to split up your logging like I do below, but I prefer to do it this way <br />
# because I can then grep for things in the logs more easily. One thing you probably want <br />
# to do is rate-limit the logging. I didn't do that here because it is probably best not too <br />
# when you first set things up ................. you actually really want to see everything going to <br />
# the logs to work out what isn't working and why. You cam implement logging with <br />
# &quot;-m limit --limit 6/h --limit-burst 5&quot; (or similar) before the -j LOG in each case. <br />
# <br />
# Any udp not already allowed is logged and then dropped.</p>
<p>iptables -A INPUT -i $IFACE -p udp -j LOG --log-prefix &quot;IPTABLES UDP-IN: &quot; <br />
iptables -A INPUT -i $IFACE -p udp -j DROP <br />
iptables -A OUTPUT -o $IFACE -p udp -j LOG --log-prefix &quot;IPTABLES UDP-OUT: &quot; <br />
iptables -A OUTPUT -o $IFACE -p udp -j DROP</p>
<p># Any icmp not already allowed is logged and then dropped.</p>
<p>iptables -A INPUT -i $IFACE -p icmp -j LOG --log-prefix &quot;IPTABLES ICMP-IN: &quot; <br />
iptables -A INPUT -i $IFACE -p icmp -j DROP <br />
iptables -A OUTPUT -o $IFACE -p icmp -j LOG --log-prefix &quot;IPTABLES ICMP-OUT: &quot; <br />
iptables -A OUTPUT -o $IFACE -p icmp -j DROP</p>
<p># Any tcp not already allowed is logged and then dropped.</p>
<p>iptables -A INPUT -i $IFACE -p tcp -j LOG --log-prefix &quot;IPTABLES TCP-IN: &quot; <br />
iptables -A INPUT -i $IFACE -p tcp -j DROP <br />
iptables -A OUTPUT -o $IFACE -p tcp -j LOG --log-prefix &quot;IPTABLES TCP-OUT: &quot; <br />
iptables -A OUTPUT -o $IFACE -p tcp -j DROP</p>
<p># Anything else not already allowed is logged and then dropped. <br />
# It will be dropped by the default policy anyway ........ but let's be paranoid.</p>
<p>iptables -A INPUT -i $IFACE -j LOG --log-prefix &quot;IPTABLES PROTOCOL-X-IN: &quot; <br />
iptables -A INPUT -i $IFACE -j DROP <br />
iptables -A OUTPUT -o $IFACE -j LOG --log-prefix &quot;IPTABLES PROTOCOL-X-OUT: &quot; <br />
iptables -A OUTPUT -o $IFACE -j DROP </p>
<p>###上面的脚本是由James C. Stephens 所整理的<br />
##是个比较全的iptables配置脚本.为了保持原汁原味方便大家学习研究使用，所有没有做任何的修改。<br />
##特发出来与大家一起分享,希望对大家有用.</p>
<p><br />
iptables学习与研究六(一些补充) 收藏 <br />
常用的处理动作： <br />
-j 参数用来指定要进行的处理动作，常用的处理动作包括：ACCEPT、REJECT、DROP、REDIRECT、MASQUERADE、LOG、DNAT、 SNAT、MIRROR、QUEUE、RETURN、MARK，分别说明如下：</p>
<p>ACCEPT 将封包放行，进行完此处理动作后，将不再比对其它规则，直接跳往下一个规则（natostrouting）。</p>
<p>REJECT 拦阻该封包，并传送封包通知对方，可以传送的封包有几个选择：ICMP port-unreachable、ICMP echo-reply 或是 tcp-reset（这个封包会要求对方关闭联机），进行完此处理动作后，将不再比对其它规则，直接 中断过滤程序。</p>
<p>范例如下： iptables -A FORWARD -p TCP --dport 22 -j REJECT --reject-with tcp-reset</p>
<p>DROP 丢弃封包不予处理，进行完此处理动作后，将不再比对其它规则，直接中断过滤程序。</p>
<p>REDIRECT 将封包重新导向到另一个端口（PNAT），进行完此处理动作后，将 会继续比对其它规则。 这个功能可以用来实作通透式 porxy 或用来保护 web 服务器。</p>
<p>例如：iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080</p>
<p>MASQUERADE 改写封包来源 IP 为防火墙 NIC IP，可以指定 port 对应的范围，进行完此处理动作后，直接跳往下一个规则 （mangleostrouting）。这个功能与 SNAT 略有不同，当进行 IP 伪装时，不需指定要伪装成哪个 IP，IP 会从网卡直接读，当使用拨接连线时，IP 通常是由 ISP 公司的 DHCP 服务器指派的，这个时候 MASQUERADE 特别有用。</p>
<p>范例如下： iptables -t nat -A POSTROUTING -p TCP -j MASQUERADE --to-ports 1024-31000</p>
<p>LOG 将封包相关讯息纪录在 /var/log 中，详细位置请查阅 /etc/syslog.conf 组态档，进行完此处理动作后，将会继续比对其 规则。</p>
<p>例如：iptables -A INPUT -p tcp -j LOG --log-prefix &quot;INPUT packets&quot;</p>
<p>SNAT 改写封包来源 IP 为某特定 IP 或 IP 范围，可以指定 port 对应的范围，进行完此处理动作后，将直接跳往下一个规则（mangleostrouting）。</p>
<p>范例如下：iptables -t nat -A POSTROUTING -p tcp-o eth0 -j SNAT --to-source 194.236.50.155-194.236.50.160:1024-32000</p>
<p>DNAT 改写封包目的地 IP 为某特定 IP 或 IP 范围，可以指定 port 对应的范围，进行完此处理动作后，将会直接跳往下一个规 炼（filter:input 或 filter:forward）。</p>
<p>范例如下：iptables -t nat -A PREROUTING -p tcp -d 15.45.23.67 --dport 80 -j DNAT --to-destination <br />
192.168.1.1-192.168.1.10:80-100</p>
<p>MIRROR 镜射封包，也就是将来源 IP 与目的地 IP 对调后，将封包送回，进行完此处理动作后，将会中断过滤程序。</p>
<p>QUEUE 中断过滤程序，将封包放入队列，交给其它程序处理。透过自行开发的处理程序，可以进行其它应用，例如：计算联机费 .......等。</p>
<p>RETURN 结束在目前规则炼中的过滤程序，返回主规则炼继续过滤，如果把自订规则炼看成是一个子程序，那么这个动作，就相当 提早结束子程序并返回到主程序中。</p>
<p>MARK 将封包标上某个代号，以便提供作为后续过滤的条件判断依据，进行完此处理动作后，将会继续比对其它规则。</p>
<p>范例如下： iptables -t mangle -A PREROUTING -p tcp --dport 22 -j MARK --set-mark 2</p>
<p>参数 -m mac --mac-source <br />
范例 iptables -A INPUT -m mac --mac-source 00:00:00:00:00:01 <br />
说明 用来比对封包来源网络接口的硬件地址，这个参数不能用在 OUTPUT 和 Postrouting 规则炼上，这是因为封包要送出到网 <br />
后，才能由网卡驱动程序透过 ARP 通讯协议查出目的地的 MAC 地址，所以 iptables 在进行封包比对时，并不知道封包会送到 <br />
个网络接口去。</p>
<p>参数 --mark <br />
范例 iptables -t mangle -A INPUT -m mark --mark 1 <br />
说明 用来比对封包是否被表示某个号码，当封包被比对成功时，我们可以透过 MARK 处理动作，将该封包标示一个号码，号码最 <br />
不可以超过 4294967296。</p>
<p>参数 -m owner --uid-owner <br />
范例 iptables -A OUTPUT -m owner --uid-owner 500 <br />
说明 用来比对来自本机的封包，是否为某特定使用者所产生的，这样可以避免服务器使用 root 或其它身分将敏感数据传送出 <br />
，可以降低系统被骇的损失。可惜这个功能无法比对出来自其它主机的封包。</p>
<p>参数 -m owner --gid-owner <br />
范例 iptables -A OUTPUT -m owner --gid-owner 0 <br />
说明 用来比对来自本机的封包，是否为某特定使用者群组所产生的，使用时机同上。</p>
<p>参数 -m owner --pid-owner <br />
范例 iptables -A OUTPUT -m owner --pid-owner 78 <br />
说明 用来比对来自本机的封包，是否为某特定行程所产生的，使用时机同上。</p>
<p>参数 -m owner --sid-owner <br />
范例 iptables -A OUTPUT -m owner --sid-owner 100 <br />
说明 用来比对来自本机的封包，是否为某特定联机（Session ID）的响应封包，使用时机同上。</p>
<p>参数 -m state --state <br />
范例 iptables -A INPUT -m state --state RELATED,ESTABLISHED <br />
说明 用来比对联机状态，联机状态共有四种：INVALID、ESTABLISHED、NEW 和 RELATED。</p>
<p>INVALID 表示该封包的联机编号（Session ID）无法辨识或编号不正确。 <br />
ESTABLISHED 表示该封包属于某个已经建立的联机。 <br />
NEW 表示该封包想要起始一个联机（重设联机或将联机重导向）。 <br />
RELATED 表示该封包是属于某个已经建立的联机，所建立的新联机。例如：FTP-DATA 联机必定是源自某个 FTP 联机。</p>
<br />(责任编辑：admin)</td></tr>
			</table>

			</div><!-- /content -->
<div align="center" style="padding-bottom:0px; padding-top:10px;">

<script src='/plus/ad_js.php?aid=3' language='javascript'></script> </div>
			<div class="dede_pages">
				<ul class="pagelist">
          
				</ul>
			</div><!-- /pages -->

			<!-- //顶踩 -->
			<div class="newdigg" id="newdigg">
				<div class="diggbox digg_good" onmousemove="this.style.backgroundPosition='left bottom';" onmouseout="this.style.backgroundPosition='left top';" onclick="javascript:postDigg('good',6428)">
					<div class="digg_act">顶一下</div>
					<div class="digg_num">(2)</div>
					<div class="digg_percent">
						<div class="digg_percent_bar"><span style="width:100%"></span></div>
						<div class="digg_percent_num">100%</div>
					</div>
				</div>
				<div class="diggbox digg_bad" onmousemove="this.style.backgroundPosition='right bottom';" onmouseout="this.style.backgroundPosition='right top';" onclick="javascript:postDigg('bad',6428)">
					<div class="digg_act">踩一下</div>
					<div class="digg_num">(0)</div>
					<div class="digg_percent">
						<div class="digg_percent_bar"><span style="width:0%"></span></div>
						<div class="digg_percent_num">0%</div>
					</div>
				</div>
			</div>
			<script language="javascript" type="text/javascript">getDigg(6428);</script>
			<!-- //顶踩部份的源码结束 -->
			
			<div class="boxoff">
				<strong>------分隔线----------------------------</strong>
			</div>
			<div class="handle">
				<div class="context">
					<ul>
						<li>上一篇：<a href='/a/anquan/kaiyuanfanghuoqiang/2010/0225/6427.html'>iptables 遇到大量 SYN_RECV，80端号占死 解决方法</a> </li>
						<li>下一篇：<a href='/a/anquan/kaiyuanfanghuoqiang/2010/0225/6429.html'>iptables limit 应用示例</a> </li>
					</ul>
				</div><!-- /context -->
				<div class="actbox">
					<ul>
						<li id="act-fav"><a href="/plus/stow.php?aid=6428" target="_blank">收藏</a></li>
						<li id="act-err"><a href="/plus/erraddsave.php?aid=6428&title=iptables 学习总结 收藏" target="_blank">挑错</a></li>
						<li id="act-pus"><a href="/plus/recommend.php?aid=6428" target="_blank">推荐</a></li>
						<li id="act-pnt"><a href="#" onClick="window.print();">打印</a></li>
					</ul>
				</div><!-- /actbox -->
			</div><!-- /handle -->
		</div><!-- /viewbox -->

<!-- //AJAX评论区 -->
<!-- //主模板必须要引入/include/dedeajax2.js -->
<a name='postform'></a>
<div class="mt1">
		<dl class="tbox">
			<dt>
				<strong>发表评论</strong>
				<span class="more"></span>
			</dt>
			<dd>
				<div class="dede_comment_post">
          <form action="#" method="post" name="feedback">
          <input type="hidden" name="dopost" value="send" />
          <input type="hidden" name="comtype" value="comments">
          <input type="hidden" name="aid" value="6428" />
          <input type="hidden" name="fid" id='feedbackfid' value="0" />
          <div class="dcmp-title">
						<small>请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。</small>
					</div><!-- /dcmp-title -->
					<div class="dcmp-stand">
						<strong>评价:</strong>
							<input type="radio" name="feedbacktype" checked="1" value="feedback" id="dcmp-stand-neu" /><label for="dcmp-stand-neu"><img src="/templets/images/cmt-neu.gif" />中立</label>
							<input type="radio" name="feedbacktype" value="good" id="dcmp-stand-good" /><label for="dcmp-stand-good"><img src="/templets/images/cmt-good.gif" />好评</label>
							<input type="radio" name="feedbacktype" value="bad" id="dcmp-stand-bad" /><label for="dcmp-stand-bad"><img src="/templets/images/cmt-bad.gif" />差评</label>
					</div><!-- /dcmp-stand -->
					<div class="dcmp-content">
						<textarea cols="60" name="msg" rows="5" class="ipt-txt"></textarea>
					</div><!-- /dcmp-content -->
					<div class="dcmp-mood">
						<strong>表情:</strong>
						<ul>
								<li><input type="radio" name='face' value='6' checked="1" /><img src="/templets/images/mood/ico-mood-6.gif" /></li>
								<li><input type="radio" name='face' value='4'/><img src="/templets/images/mood/ico-mood-4.gif" /></li>
								<li><input type="radio" name='face' value='3'/><img src="/templets/images/mood/ico-mood-3.gif" /></li>
								<li><input type="radio" name='face' value='5'/><img src="/templets/images/mood/ico-mood-5.gif" /></li>
								<li><input type="radio" name='face' value='2'/><img src="/templets/images/mood/ico-mood-2.gif" /></li>
								<li><input type="radio" name='face' value='1'/><img src="/templets/images/mood/ico-mood-1.gif" /></li>
								<li><input type="radio" name='face' value='7'/><img src="/templets/images/mood/ico-mood-7.gif" /></li>
						</ul>
					</div><!-- /dcmp-mood -->
					<div class="dcmp-post"><!--未登陆-->
							<div class="dcmp-userinfo" id="_ajax_feedback">
								用户名:<input type="text" name="username" size="16" class="ipt-txt" />密码:<input name="pwd" type="password" size="16" class="ipt-txt" />
								验证码:<input type='text' name='validate' size='4' class='ipt-txt' /><img src="/include/vdimgck.php" id="validateimg" style="cursor:pointer" onclick="this.src=this.src+'?'" title="点击我更换图片" alt="点击我更换图片" />
                <input type="checkbox" name="notuser" id="dcmp-submit-guest" /><label for="dcmp-submit-guest" />匿名? </label>
							</div>
              <script language="javascript" type="text/javascript">CheckLogin();</script>
							<div class="dcmp-submit">
								<button type="button" onClick='PostComment()'>发表评论</button>
							</div>
						</div>
        </form>
				</div>
			</dd>
		</dl>
	</div><!-- //评论表单区结束 -->

<!-- //评论内容区 -->
	<a name='commettop'></a>
	<div class="mt1">
			<dl class="tbox">
				<dt>
					<strong>最新评论</strong>
					<span class="more"><a href="/plus/feedback.php?aid=6428">进入详细评论页&gt;&gt;</a></span>
				</dt>
				<!-- //这两个ID的区块必须存在，否则JS会出错 -->
				<dd id='commetcontentNew'></dd>
				<dd id='commetcontent'></dd>
			</dl>
	</div>
<!--
//由于评论载入时使用异步传输，因此必须在最后一步加载（DIGG和评论框须放在评论内容前面）
//如果一定需要提前的把myajax.SendGet改为myajax.SendGet2，但可能会引起页面阻滞
-->
<script language='javascript'>
function LoadCommets(page)
{
		var taget_obj = document.getElementById('commetcontent');
		var waithtml = "<div style='line-height:50px'><img src='/images/loadinglit.gif' />评论加载中...</div>";
		var myajax = new DedeAjax(taget_obj, true, true, '', 'x', waithtml);
		myajax.SendGet2("/plus/feedback_ajax.php?dopost=getlist&aid=6428&page="+page);
		DedeXHTTP = null;
}
function PostComment()
{
		var f = document.feedback;
		var nface = '6';
		var nfeedbacktype = 'feedback';
		var nvalidate = '';
		var nnotuser = '';
		var nusername = '';
		var npwd = '';
		var taget_obj = $DE('commetcontentNew');
		var waithtml = "<div style='line-height:30px'><img src='/images/loadinglit.gif' />正在发送中...</div>";
		if(f.msg.value=='')
		{
			alert("评论内容不能为空！");
			return;
		}
		if(f.validate)
		{
			if(f.validate.value=='') {
				alert("请填写验证码！");
				return;
			}
			else {
				nvalidate = f.validate.value;
			}
		}
		if(f.msg.value.length > 500)
		{
			alert("你的评论是不是太长了？请填写500字以内的评论。");
			return;
		}
		if(f.feedbacktype) {
			for(var i=0; i < f.feedbacktype.length; i++)
				if(f.feedbacktype[i].checked) nfeedbacktype = f.feedbacktype[i].value;
		}
		if(f.face) {
			for(var j=0; j < f.face.length; j++)
				if(f.face[j].checked) nface = f.face[j].value;
		}
		if(f.notuser.checked) nnotuser = '1';
		if(f.username) nusername = f.username.value;
		if(f.pwd) npwd = f.pwd.value;
		
		var myajax = new DedeAjax(taget_obj, false, true, '', '', waithtml);
		myajax.sendlang = 'gb2312';
		myajax.AddKeyN('dopost', 'send');
		myajax.AddKeyN('aid', '6428');
		myajax.AddKeyN('fid', f.fid.value);
		myajax.AddKeyN('face', nface);
		myajax.AddKeyN('feedbacktype', nfeedbacktype);
		myajax.AddKeyN('validate', nvalidate);
		myajax.AddKeyN('notuser', nnotuser);
		myajax.AddKeyN('username', nusername);
		myajax.AddKeyN('pwd', npwd);
		myajax.AddKeyN('msg', f.msg.value);
		myajax.SendPost2('/plus/feedback_ajax.php');
		f.msg.value = '';
		f.fid.value = 0;
		if(f.validate)
		{
			if($DE('validateimg')) $DE('validateimg').src = "/include/vdimgck.php?"+f.validate.value;
			f.validate.value = '';
		}
}
function quoteCommet(fid)
{
	document.feedback.fid.value = fid;
}
LoadCommets(1);
</script><!-- //评论内容区结束 -->


</div><!-- //左边内容结束 -->

<!-- //右边内容开始 -->
<div class="pright">
 		
		<div class="commend mt1">
			<dl class="tbox light">
<script src='/plus/ad_js.php?aid=5' language='javascript'></script>
				<dt class='light'><strong>推荐内容</strong></dt>
				<dd class='light'>
					<ul class="d4">
           <li><a href="/a/anquan/kaiyuanfanghuoqiang/2009/1119/367.html">FREEBSD中使用IPFW来过滤ICMP服务</a>
            	<p>FREEBSD中可以使用IPFW来停止PING的响应，即可以调制内核和使用IPFW来拒绝 ICMP服务，这样别人用PING就看不到任何信息了。 先介绍下IPFW...</p>
            </li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2009/1116/112.html">FreeBSD7.0+opengate+ipfw(网页网关认证)Captive Po</a>
            	<p>介绍 如果用过 [url=javascript:;] m0n0wall [/url] 这个东西的朋友应该知道里面有个Captive [url=javascrip...</p>
            </li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2009/1116/111.html">NETBSD+ADSL+IPF+QDNS</a>
            	<p>配置网卡的IP地址： # vi /etc/ifconfig.rtk0 inet 192.168.0.1 netmask 255.255.255.0 # vi /...</p>
            </li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2009/1116/110.html">OpenBSD下PF防火墙典型应用(针对FTP环境)</a>
            	<p>PF防火墙起源于OPENBSD项目。近年来FREEBSD/NETBSD也开始支持PF防火墙了，在BSD系统中PF防火墙变得越来越流行了。这里我们重点结合 [ur...</p>
            </li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2009/1116/109.html">Freebsd PF防火墙实现策略路由</a>
            	<p>利用PF实现策略路由 1．说明： 此方案适用于可以使用PF做为 [url=javascript:;] 防火墙 [/url] 的操作系统，包括FREEBSD/OP...</p>
            </li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2009/1116/108.html">pf防火墙防止ssh、ftp暴力攻</a>
            	<p>用pf防止ssh、ftp暴力攻击 1.在/etc/pf.conf加入底下t tablepersist tablepersist block quick fro...</p>
            </li>

					</ul>
				</dd>
			</dl>
		</div><!-- /commend -->


<script src='/plus/ad_js.php?aid=20' language='javascript'></script>


		<div class="hot mt1">
			<dl class="tbox light">
				<dt class='light'><strong>热点内容</strong></dt>
				<dd class='light'>
					<ul class="c1 ico2">
             <li><a href="/a/anquan/kaiyuanfanghuoqiang/2010/0401/8964.html">Linux防火墙 配置文件 iptables详解</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2010/0225/6467.html">linux iptables限速及限制每IP连接数</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2009/1214/1526.html">Linux iptables配置FTP的主动和被动模式</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2010/0311/7526.html">Ubuntu iptables 入门 设置静态防火墙</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2010/0311/7515.html">Ubuntu iptables 入门 教程</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2010/0225/6428.html">iptables 学习总结 收藏</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2010/0106/2647.html">Ubuntu iptables详细教程-基本命令</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2009/1119/372.html">VMWare上实现FreeBSD的PPPoE网关（IPFW+</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2010/0225/6463.html">常用的 iptables配置脚本</a></li>
<li><a href="/a/anquan/kaiyuanfanghuoqiang/2010/0126/4569.html">iptables 限速Shell无需TC(限制NAT机器上I</a></li>

					</ul>
				</dd>
			</dl>
		</div>




	</div><!-- /pright -->
</div>

<!-- //二级子类下拉菜单，考虑SEO原因放置于底部  -->
<script type='text/javascript' src='/images/js/dropdown.js'></script>
<ul id="dropmenu1" class="dropMenu">
  
</ul><ul id="dropmenu2" class="dropMenu">
    <li><a href="/a/ITrenzheng/sikekaoshizhanbao/">思科考试战报</a></li>
    <li><a href="/a/ITrenzheng/CCNAdianzishu/">CCNA电子书</a></li>
    <li><a href="/a/ITrenzheng/CCSPdianzishu/">CCSP电子书</a></li>
    <li><a href="/a/ITrenzheng/CCNPdianzishu/">CCNP电子书</a></li>
    <li><a href="/a/ITrenzheng/CCIEdianzishu/">CCIE电子书</a></li>
    <li><a href="/a/ITrenzheng/ITwangluoshiyanshi/">IT网络实验室</a></li>
    <li><a href="/a/ITrenzheng/luntanzixun/">论坛咨询</a></li>
  
</ul><ul id="dropmenu10" class="dropMenu">
    <li><a href="/a/Ciscomoniqi/Cisco_ios_xiazai/">Cisco ios 下载</a></li>
    <li><a href="/a/Ciscomoniqi/Ciscomoniqiruanjian/">Cisco模拟器软件</a></li>
  
</ul><ul id="dropmenu13" class="dropMenu">
    <li><a href="/a/luyoujiaohuan/Ciscojishu/">Cisco技术</a></li>
    <li><a href="/a/luyoujiaohuan/huaweijishu/">华为技术</a></li>
    <li><a href="/a/luyoujiaohuan/Juniperjishu/">Juniper技术</a></li>
    <li><a href="/a/luyoujiaohuan/dianzishu/">电子书</a></li>
    <li><a href="/a/luyoujiaohuan/peizhishili/">配置实例</a></li>
  
</ul><ul id="dropmenu19" class="dropMenu">
    <li><a href="/a/anquan/Ciscoanquan/">Cisco安全</a></li>
    <li><a href="/a/anquan/Juniperanquan/">Juniper安全</a></li>
    <li><a href="/a/anquan/huaweianquan/">华为安全</a></li>
    <li><a href="/a/anquan/kaiyuanfanghuoqiang/">开源防火墙</a></li>
    <li><a href="/a/anquan/dianzishu/">电子书</a></li>
    <li><a href="/a/anquan/xitonganquan/">系统安全</a></li>
  
</ul><ul id="dropmenu25" class="dropMenu">
    <li><a href="/a/caozuoxitong/Linux/">Linux</a></li>
    <li><a href="/a/caozuoxitong/Unix/">Unix</a></li>
    <li><a href="/a/caozuoxitong/windows/">windows</a></li>
    <li><a href="/a/anquan/Backtrack/">Backtrack</a></li>
  
</ul><ul id="dropmenu171" class="dropMenu">
    <li><a href="/ziliaoxiazai/sikeziliaoxiazai/">思科</a></li>
    <li><a href="/ziliaoxiazai/Linux/">Linux</a></li>
    <li><a href="/ziliaoxiazai/ITdianzishuxiazai/">IT电子书下载</a></li>
    <li><a href="/ziliaoxiazai/shujukuziliaoxiazai/">数据库资料下载</a></li>
    <li><a href="/ziliaoxiazai/weiruanziliaoxiazai/">微软下载</a></li>
    <li><a href="/ziliaoxiazai/shipinxiazai/">视频下载</a></li>
  
</ul><ul id="dropmenu164" class="dropMenu">
    <li><a href="/ziliaoxiazai/sikeziliaoxiazai/">思科资料下载</a></li>
    <li><a href="/ziliaoxiazai/weiruanziliaoxiazai/">微软资料下载</a></li>
    <li><a href="/ziliaoxiazai/shujukuziliaoxiazai/">数据库资料下载</a></li>
    <li><a href="/ziliaoxiazai/Linux___unix_ziliaoxiazai/">Linux & unix 资料下载</a></li>
    <li><a href="/ziliaoxiazai/shipinziliaoxiazai/">视频资料下载</a></li>
  
</ul><ul id="dropmenu36" class="dropMenu">
    <li><a href="/shujukuguanli/Oracle/">Oracle</a></li>
    <li><a href="/shujukuguanli/Mysql/">Mysql</a></li>
    <li><a href="/shujukuguanli/Mssql/">Mssql</a></li>
  
</ul><ul id="dropmenu40" class="dropMenu">
    <li><a href="/yunjisuan/yunjisuan/">云计算</a></li>
  
</ul>
<script type="text/javascript">cssdropdown.startchrome("navMenu")</script>

<!-- //底部模板 -->
<div class="footer w960 center mt1 clear">
	<!-- 
		为了支持织梦团队的发展,请您保留织梦内容管理系统的链接信息.
		我们对支持织梦团队发展的朋友表示真心的感谢!织梦因您更精彩!
	-->
	<p class="copyright">
		本站为了方便大家学习，资料全部都是从网络上搜集来的，如果作者觉得侵犯了自己的利益，请和我们联系。Powered by  &#169; 2004-2009 </p>

<!-- /powered -->
	<p class="copyright">
		Copyright &copy; 2002-2011 <b><a href="http://www.net527.cn/">Cisco 论坛</a></b><script language="javascript" type="text/javascript" src="http://js.users.51.la/3434535.js"></script><br />
  </p>
</div>
<!-- /footer -->

</body>
</html>
