<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>利用openfiler实现iSCSI(原创) - CzmMiao的博客生活 - ITeye技术网站</title>
    <meta name="description" content="iSCSI概述          iSCSI：Internet 小型计算机系统接口 （iSCSI：Internet Small Computer System Interface）。  Internet 小型计算机系统接口（iSCSI）是一种基于 TCP/IP的协 ..." />
    <meta name="keywords" content=" 利用openfiler实现iSCSI(原创)" />
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
    <link rel="search" type="application/opensearchdescription+xml" href="/open_search.xml" title="ITeye" />
    <link href="/rss" rel="alternate" title="CzmMiao的博客生活" type="application/rss+xml" />
    <link href="http://www.iteye.com/stylesheets/blog.css?1384928085" media="screen" rel="stylesheet" type="text/css" />
<link href="http://www.iteye.com/stylesheets/themes/blog/red.css?1326191326" media="screen" rel="stylesheet" type="text/css" />
    <script src="http://www.iteye.com/javascripts/application.js?1358214518" type="text/javascript"></script>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-535605-1']);
  _gaq.push(['_setDomainName', 'iteye.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


      <link href="http://www.iteye.com/javascripts/syntaxhighlighter/SyntaxHighlighter.css?1348819953" media="screen" rel="stylesheet" type="text/css" />
  <script src="http://www.iteye.com/javascripts/syntaxhighlighter/shCoreCommon.js?1325907333" type="text/javascript"></script>
<script src="http://www.iteye.com/javascripts/hotkey.js?1324994303" type="text/javascript"></script>
  <script src="http://www.iteye.com/javascripts/code_favorites.js?1358214518" type="text/javascript"></script>
<script src="http://www.iteye.com/javascripts/weiboshare.js?1324994303" type="text/javascript"></script>
  </head>
  <body>
    <div id="header">
      <div id="blog_site_nav">
  <a href="http://www.iteye.com/" class="homepage">首页</a>
  <a href="http://www.iteye.com/news">资讯</a>
  <a href="http://www.iteye.com/magazines">精华</a>
  <a href="http://www.iteye.com/forums">论坛</a>
  <a href="http://www.iteye.com/ask">问答</a>
  <a href="http://www.iteye.com/blogs">博客</a>
  <a href="http://www.iteye.com/blogs/subjects">专栏</a>
  <a href="http://www.iteye.com/groups">群组</a>
  <a href="#" onclick="return false;" id="msna"><u>更多</u> <small>▼</small></a>
  <div class="quick_menu" style="display:none;">
    <a target="_blank" href="http://job.iteye.com/iteye">招聘</a>
    <a href="http://www.iteye.com/search">搜索</a>
  </div>
</div>

      <div id="user_nav">
      <a href="/login" class="welcome" title="登录">您还未登录 !</a>
    <a href="/login">登录</a>
    <a href="/signup" class="nobg">注册</a>
  </div>

    </div>

    <div id="page">
      <div id="branding" class="clearfix">
        <div id="blog_name">
          <h1><a href="/">CzmMiao的博客生活</a></h1>
        </div>
        <div id='fd'></div>
        <div id="blog_navbar">
          <ul>
            <li class='blog_navbar_for'><a href="http://czmmiao.iteye.com"><strong>博客</strong></a></li>
            <li ><a href="/weibo">微博</a></li>
            <li ><a href="/album">相册</a></li>
            <li ><a href="/link">收藏</a></li>
            <li ><a href="/blog/guest_book">留言</a></li>
            <li ><a href="/blog/profile">关于我</a></li>
          </ul>
    
          <div class="search">
            <form action="/blog/search" method="get">
              <input class="search_text" id="query" name="query" style="margin-left: 10px;width: 110px;" type="text" value="" />
              <input class="submit_search" type="submit" value="" />
            </form>
          </div> 
          <div id="fd"></div>         
        </div>
      </div>
      
      <div id="content" class="clearfix">
        <div id="main">
          



          


<div class="h-entry" style='display:none'>
  <a href="http://czmmiao.iteye.com" class="p-author" target="_blank">czmmiao</a>
</div>


<div class="blog_main">
  <div class="blog_title">
    <h3>
      <a href="/blog/1735417">利用openfiler实现iSCSI(原创)</a>
      <em class="actions">      </em>
    </h3>
    <ul class='blog_categories'><strong>博客分类：</strong> <li><a href="/category/143957">Linux/Unix日常管理</a></li> </ul>
        <div class='news_tag'>&nbsp;</div>
  </div>

  <div id="blog_content" class="blog_content">
    <p style="text-align: left;"><span style="color: #ff0000; font-size: small;"><strong>iSCSI概述</strong>
</span>
<span style="font-size: small;">
<span>
<span><br>
iSCSI：Internet 小型计算机系统接口 （iSCSI：Internet Small Computer System Interface）。<br>
Internet 小型计算机系统接口（iSCSI）是一种基于 TCP/IP的协议，用来建立和管理IP存储设备、主机和客户机等之间的相互连接，并创建存储区域网络（SAN）。SAN 使得 SCSI 协议应用于高速数据传输网络成为可能，这种传输以数据块级别（block-level）在多个数据存储网络间进行。<br>
SCSI 结构基于客户/服务器模式，其通常应用环境是：设备互相靠近，并且这些设备由SCSI总线连接。iSCSI的主要功能是在 TCP/IP 网络上的主机系统（启动器 initiator）和存储设备（目标器 target）之间进行大量数据的封装和可靠传输过程。此外，iSCSI 提供了在 IP 网络封装 SCSI 命令，且运行在 TCP 上。<br>
iSCSI（Internet SCSI）是2003年IETF（InternetEngineering Task Force，互联网工程任务组）制订的一项<br>
bcm5722 ISCSI网卡标准，用于将SCSI数据块映射成以太网数据包。SCSI（Small Computer System Interface）是块数据传输协议，在存储行业广泛应用，是存储设备最基本的标准协议。从根本上说，iSCSI协议是一种利用IP网络来传输潜伏时间短的SCSI数据块的方法，ISCSI使用以太网协议传送SCSI命令、响应和数据。ISCSI可以用我们已经熟悉和每天都在使用的以太网来构建IP存储局域网。通过这种方法，ISCSI克服了直接连接存储的局限性，使我们可以跨不同服务器共享存储资源，并可以在不停机状态下扩充存储容量。<br><span style="color: #ff0000;"><strong>iSCSI的工作过程</strong>
</span>
<br>
当iSCSI主机应用程序发出数据读写请求后，操作系统会生成一个相应的SCSI命令，该SCSI命令在iSCSI initiator层被封装成ISCSI消息包并通过TCP/IP传送到设备侧，设备侧的iSCSI target层会解开iSCSI消息包，得到SCSI命令的内容，然后传送给SCSI设备执行；设备执行SCSI命令后的响应，在经过设备侧iSCSI target层时被封装成ISCSI响应PDU，通过TCP/IP网络传送给主机的ISCSI initiator层，iSCSI initiator会从ISCSI响应PDU里解析出SCSI响应并传送给操作系统，操作系统再响应给应用程序。<br><strong><span style="color: #ff0000;">iSCSI 启动器</span>
</strong>
<br>
从本质上说，iSCSI 启动器是一个客户端设备，它连接到服务器提供的某一服务，并发起对该服务的请求。如果利用iscsi创建RAC，iSCSI 启动器软件需要安装在每个 Oracle RAC 节点上。<br>
iSCSI 启动器可以用软件实现，也可以用硬件实现。软件 iSCSI 启动器可用于大部分主要操作系统平台，可以使用 iscsi-initiator-utils RPM中提供的免费 Linux Open-iSCSI 软件驱动程序。iSCSI 软件启动器通常与标准网络接口卡 (NIC)（大多数情况下是千兆位以太网卡）配合使用。硬件启动器是一个 iSCSI HBA（或 TCP 卸载引擎 (TOE) 卡），它本质上只是一个专用以太网卡，其上的 SCSI ASIC 可以从系统 CPU 内卸载所有工作（TCP 和 SCSI 命令）。iSCSI HBA 可以从许多供应商处购买，包括 Adaptec、Alacritech、Intel 和 QLogic。<br><span style="color: #ff0000;"><strong>iSCSI 目标</strong>
</span>
<br>
iSCSI 目标是 iSCSI 网络的“服务器”组件。它通常是一个存储设备，包含您所需的信息并响应来自（一个或多个）启动器的请求。对于本文，节点 openfiler1 将是 iSCSI 目标。<br><strong><span style="color: #ff0000;">openfiler</span>
</strong>
<br>
openfiler是一个基于浏览器的网络存储管理工具。来自于Linux系统。openfiler在一个网络架构里面里面支持文件级的NAS和数据块级的SAN，支持CIFS，NFS，HTT/DAV，FTP 和iSCSI协议。openfiler是一个存储管理操作系统，基于Linux 2.6内核和其他开源程序比如apache，samba，lvm2，ext3,Linux NFS和iSCSI企业级target。他把这些所有的技术集成在一个很小的，易于管理的强大的web界面里。</span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><strong><span style="color: #ff0000;">配置openfiler</span>
</strong>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">openfiler的安装和安装linux类似，十分简单这里不做过多介绍，不明白的读者可以自行查阅资料。以下配置环境是以RAC配置为基础，目标是将openfiler上的存储空间已共享存储的方式划分给rac1和rac2两个节点。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">浏览器：Firefox3.6(不推荐用IE进行此设置，下面会讲原因)<br>
客户端操作系统：RHEL 5.4<br>
iSCSI客户端：open-iscsi-2.0-871<br></span>
</p>
<p style="text-align: left;"><span style="font-size: small;">要将 Openfiler 用作 iSCSI 存储服务器，我们需要执行六个主要任务：设置 iSCSI 服务、配置网络访问、指定物理存储器并对其分区、创建新的卷组、创建所有逻辑卷，最后，为每个逻辑卷创建新的 iSCSI 目标。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><strong>服务</strong>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><span>在浏览器</span>
输入https://192.168.2.195:446/ </span>
<span style="font-size: small;">
<span>
<span><span>开启Openfiler的Web界面</span>
,这里192.168.2.195为openfiler系统的ip，446为服务端口。Openfiler的默认用户名为openfiler，密码为password。</span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">要控制服务，我们使用 Openfiler Storage Control Center 并转到 [Services] / [Manage Services]： </span>
<span style="font-size: small;">
<span>
<span><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/124380.gif" alt=" "><br></span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">要启用 iSCSI 服务，单击“iSCSI target server”服务名称后面的“Enable”链接。之后，“iSCSI target server”状态应变为“<span style="color: #0000ff;"><tt>Enabled</tt>
</span>
”。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><tt>ietd</tt>
 程序将实现 iSCSI Enterprise Target 软件的用户级部分，以便在 Linux 上构建 
iSCSI 存储系统。启用 iSCSI target 之后，我们应该能够通过 SSH 登录到 Openfiler 服务器，并且可看到      
                     <tt>iscsi-target</tt>
 服务正在运行：</span>
</p>
<p><span style="font-family: Courier New; color: #008000; font-size: small;">[root@openfiler1 ~]# service iscsi-target status
</span>
</p>
<p><span style="font-family: Courier New; color: #008000; font-size: small;">
ietd (pid 14243) is running...</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><span>                          <strong>网络访问配置</strong>
                         </span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">下一步是配置 Openfiler 中的网络访问，指定需要通过存储（专用）网络访问 iSCSI 卷的两个 Oracle RAC 节点（<tt>racnode1</tt>
 和                           <tt>racnode2</tt>
）。注意，本节稍后
将会创建 iSCSI 卷。另请注意，本步骤并不实际授予两个 Oracle RAC 节点访问 iSCSI 逻辑卷所需的相应权限。授予权限的操作将在本节稍后通过对每个新逻辑卷更新 ACL
 来进行。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">如同上一节，我们使用 Openfiler Storage Control Center 并转到 [System] / [Network 
Setup] 来完成网络访问配置。通过页面底部的“Network Access 
Configuration”部分，管理员可以设置网络和/或主机以允许其访问 Openfiler appliance 
导出的资源。就本文而言，我们希望单独添加两个 Oracle RAC 节点，而不是允许整个                           <tt>192.168.2.0</tt>
 网络访问 Openfiler 资源。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">输入每个 Oracle RAC 节点时，请注意“Name”域只是一个逻辑名称，仅供参考。根据输入节点的惯例，我仅使用了为该 IP 
地址定义的节点名称。接下来，在“Network/Host”域中输入实际节点时，始终使用其 IP 地址，即使其主机名已经在            
               <tt>/etc/hosts</tt>
 文件或 DNS 中定义。最后，在我们的 C 类网络中输入实际主机时，使用子网掩码                           <tt>255.255.255.255</tt>
。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">记住，您要为集群中的每个 RAC 节点输入<em>专用</em>
 网络 (<tt>eth1</tt>
) 的 IP 地址，这一点很重要。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">下图显示了添加两个 Oracle RAC 节点后的结果：<br><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/125962.gif" alt=" "></span>
<span style="font-size: small;">
<span>
<span>                         <br></span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><span>                          <strong>物理存储</strong>
                         </span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">在本节中，我们将创建三个 iSCSI 卷，以供集群中的两个 Oracle RAC 节点用作共享存储。这将在连接到 Openfiler 服务器的内置 73GB 15K SCSI 硬盘驱动器上执行多个步骤。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">存储设备（如内置 IDE/SATA/SCSI/SAS 磁盘、存储阵列、外置 USB 驱动器、外置 FireWire 
驱动器或者任何其他存储设备）可以连接到 Openfiler 服务器，并供客户端使用。如果在操作系统级发现了这些设备，就可以使用 
Openfiler Storage Control Center 设置和管理所有这些存储设备。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">在本例中，我们有一个 73GB 的内置 SCSI 硬盘驱动器用于满足共享存储之需。在 Openfiler 服务器上，该驱动器显示为                           <tt>/dev/sdb</tt>
 (MAXTOR ATLAS15K2_73SCA)。要看到该驱动器并启动 iSCSI 卷的创建过程，请从 Openfiler Storage Control Center 转到 [Volumes] / [Block Devices]：</span>
<span style="font-size: small;">
<span>
<span><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/124433.gif" alt=" "><br></span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><strong>对物理磁盘进行分区</strong>
<br>
我们要执行的第一步是在 /dev/sdb 内置硬盘上创建一个主分区。单击 /dev/sdb 链接，我们会看到“Edit”或“Create”选项，分别用于编辑和创建分区。由于我们将创建一个跨整个磁盘的主分区，因此可以将大多数选项保留为默认设置，唯一的修改是将“Partition Type ”由“Extended partition”更改为“Physical volume ”。下面是我为了在 /dev/sdb 上创建主分区而指定的值：<br>
模式： Primary<br>
分区类型： Physical volume<br>
开始柱面： 1<br>
结束柱面： 8924<br>
现在，大小将显示 68.36 GB。要接受该设置，单击“Create”按钮。这将在我们的内置硬盘上生成一个新的分区 (/dev/sdb1 )：</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/103670.gif" alt=" "></span>
<span style="font-size: small;">
<span>
<span>                           <br><span>                             <strong>图 9</strong>
：对物理卷进行分区                           </span>
</span>
</span>
</span>
</p>
<blockquote style="text-align: left;">
</blockquote>
<p style="text-align: left;"><span style="font-size: small;"><span><strong>卷组管理</strong>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">下一步是创建<em>卷组</em>
。我们将创建一个名为                             <tt>racdbvg</tt>
 的卷组，其中包含新创建的主分区。从 Openfiler Storage Control Center 中转到 [Volumes] / [Volume 
Groups]。我们将看到所有现有的卷组，或者什么也看不到（我们的情况就是这样）。在 Volume Group Management 
屏幕中，输入新卷组的名称 (<tt>racdbvg</tt>
)，单击                             <tt>/dev/sdb1</tt>
 前面的复选框以选中该分区，最后单击“Add volume group”按钮。之后，我们会看到一个列表，其中显示出我们新创建的这个名为“<tt>racdbvg</tt>
”的卷组：<br><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/123416.gif" alt=" "></span>
<span style="font-size: small;">
<span>
<span>                           </span>
<span><span><strong>逻辑卷</strong>
</span>
</span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">现在，我们可以在新创建的卷组 (<tt>racdbvg</tt>
) 中创建三个逻辑卷。从 Openfiler Storage Control Center 中转到 [Volumes] / [Add Volume]。我们将看到新创建的卷组 (<tt>racdbvg</tt>
) 及其块存储统计信息。该屏幕底部还提供了一个选项，用于在选定的卷组中创建一个新卷 —<em>（在“racdbvg”中创建一个卷）</em>
。使用该屏幕创建以下三个逻辑 (iSCSI) 卷。在创建每个逻辑卷之后，应用程序将转至“Manage Volumes”屏幕。然后，您需要单击后退到“Add Volume”选项卡以创建下一个逻辑卷，直至三个 iSCSI 卷全部创建完毕：</span>
</p>
<blockquote style="text-align: left;">
<table cellspacing="1" border="1" style="text-align: left;" cellpadding="3">
<tr>
<td>
<span style="font-size: small;"><strong>iSCSI / 逻辑卷</strong>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><strong>卷名</strong>
</span>
</td>
<td>
<span style="font-size: small;"><strong>卷描述</strong>
</span>
</td>
<td>
<span style="font-size: small;"><strong>所需空间 (MB)</strong>
</span>
</td>
<td>
<span style="font-size: small;"><strong>文件系统类型</strong>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><code>racdb-crs1</code>
</span>
</td>
<td>
<span style="font-size: small;">racdb - ASM CRS Volume 1</span>
</td>
<td>
<span style="font-size: small;">2,208</span>
</td>
<td>
<span style="font-size: small;">iSCSI</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><code>racdb-data1</code>
</span>
</td>
<td>
<span style="font-size: small;">racdb - ASM Data Volume 1</span>
</td>
<td>
<span style="font-size: small;">33,888</span>
</td>
<td>
<span style="font-size: small;">iSCSI</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><code>racdb-fra1</code>
</span>
</td>
<td>
<span style="font-size: small;">racdb - ASM FRA Volume 1</span>
</td>
<td>
<span style="font-size: small;">33,888</span>
</td>
<td>
<span style="font-size: small;">iSCSI</span>
</td>
</tr>
</table>
<p style="text-align: left;"><span style="font-size: small;">实际上，我们已经创建了三个 iSCSI 磁盘，现在可以将它们呈现给网络上的 iSCSI 客户端（<tt>racnode1</tt>
 和                             <tt>racnode2</tt>
）。“Manage Volumes”屏幕应如下所示：<br><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/121935.gif" alt=" "></span>
<span style="font-size: small;">
<span><span><br></span>
</span>
</span>
</p>
</blockquote>
<p style="text-align: left;"><span style="font-size: small;"><span>                          <strong>iSCSI 目标</strong>
                         </span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">现在，我们有了三个 iSCSI 逻辑卷。但是，为了使 iSCSI 客户端可以访问这些逻辑卷，首先需要为这三个卷中的每个卷创建一个 iSCSI 目标。每个 iSCSI 逻辑卷将<em>映射</em>
 到一个特定的 iSCSI 目标，并将为两个 Oracle RAC 节点授予对该目标的相应网络访问权限。对于本文，在 iSCSI 逻辑卷和 iSCSI 目标之间将会有一一映射的关系。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">创建和配置 iSCSI 目标的过程包括三步：创建一个唯一的目标 IQN（实质上是新的 iSCSI 目标的通用名称），将上一节中创建的一个 
iSCSI 逻辑卷映射到新创建的 iSCSI 目标，最后，授予两个 Oracle RAC 节点访问该新 iSCSI 
目标的权限。请注意，需要对上一节中创建的三个 iSCSI 逻辑卷中的<span style="text-decoration: underline;">每个</span>
卷都执行一次此过程。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">对于本文，下表列出了新的 iSCSI 目标名称（目标 IQN）及其将映射到的 iSCSI 逻辑卷：</span>
</p>
<table cellspacing="1" width="550" border="1" style="text-align: left;" cellpadding="3">
<tr>
<td>
<span style="font-size: small;"><strong>iSCSI 目标/逻辑卷映射</strong>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><strong>目标 IQN</strong>
</span>
</td>
<td>
<span style="font-size: small;"><strong>iSCSI 卷名</strong>
</span>
</td>
<td>
<span style="font-size: small;"><strong>卷描述</strong>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><code>iqn.2006-01.com.openfiler:racdb.crs1</code>
</span>
</td>
<td>
<span style="font-size: small;"><code>racdb-crs1</code>
</span>
</td>
<td>
<span style="font-size: small;">racdb - ASM CRS Volume 1</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><code>iqn.2006-01.com.openfiler:racdb.data1</code>
</span>
</td>
<td>
<span style="font-size: small;"><code>racdb-data1</code>
</span>
</td>
<td>
<span style="font-size: small;">racdb - ASM Data Volume 1</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><code>iqn.2006-01.com.openfiler:racdb.fra1</code>
</span>
</td>
<td>
<span style="font-size: small;"><code>racdb-fra1</code>
</span>
</td>
<td>
<span style="font-size: small;">racdb - ASM FRA Volume 1</span>
</td>
</tr>
</table>
<p style="text-align: left;"><span style="font-size: small;">现在我们来创建三个新的 iSCSI 目标 — 为每个 iSCSI 逻辑卷创建一个。下面举例说明通过创建 Oracle Clusterware/racdb-crs1 目标 (                         <code>iqn.2006-01.com.openfiler:racdb.crs1</code>
) 来创建新的 iSCSI 目标时所需执行的三个步骤。这个三步过程需要对上表中列出的三个新 iSCSI 目标中的每一个都重复执行一遍。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><span>                          <strong>创建新目标 IQN</strong>
                         </span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">从 Openfiler Storage Control Center 中转到 [Volumes] / [iSCSI 
Targets]。确保选择了灰色子选项卡“Target Configuration”。您可在此选项卡页中创建一个新的 iSCSI 
目标。系统会自动生成一个默认值，作为新 iSCSI 目标的名称（常称为“目标 IQN”）。目标 IQN 的一个示例是“<code>iqn.2006-01.com.openfiler:tsn.ae4683b67fd3</code>
”：</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><br><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/103503.gif" alt=" "></span>
<span style="font-size: small;">
<span>
<span>                         <br></span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">我喜欢用更具含义的字串来替换这个默认目标 IQN 最后一段。对于第一个 iSCSI 目标（Oracle Clusterware/racdb-crs1），我将这样来修改默认的目标 IQN：将字符串“<code>tsn.ae4683b67fd3</code>
”替换为“<code>racdb.crs1</code>
”，如下<span>图</span>
所示： </span>
<span style="font-size: small;">
<span>
<span><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/124395.gif" alt=" "><br></span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">对新的目标 IQN 满意之后，单击“Add”按钮。这将会创建一个新的 iSCSI 目标，然后会出现一个页面，您可以在该页面中修改新 iSCSI 目标的一系列设置。对于本文，无需更改新 iSCSI 目标的任何设置。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><span>                          <strong>LUN 映射</strong>
                         </span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">创建新的 iSCSI 目标之后，下一步是将相应的 iSCSI 逻辑卷映射到该目标。在“Target 
Configuration”子选项卡下，验证在“Select iSCSI Target”部分中选择了正确的 iSCSI 
目标。如果不是这样，使用下拉菜单选择正确的 iSCSI 目标，然后单击“Change”按钮。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">接下来，单击名为“LUN Mapping”的灰色子选项卡（在“Target Configuration”子选项卡旁）。找到相应的 iSCSI 逻辑卷（本例中为                           <tt>/dev/racdbvg/racdb-crs1</tt>
），然后单击“Map”按钮。无需更改此页面中的任何设置。对卷                           <tt>/dev/racdbvg/racdb-crs1</tt>
 单击“Map”按钮后，您的屏幕应如下图所示：<br><a name="Figure_14"></a>
</span>
<span style="font-size: small;">
<span>
<span>                           <img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/117572.gif" alt=" "><br></span>
</span>
</span>
</p>
<p style="text-align: left;">
<span style="font-size: small;">
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><span>                          <strong>网络 ACL</strong>
                         </span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">需要先授予 iSCSI 客户端相应的权限，它才能访问新创建的 iSCSI 目标。在前面，我们已通过 Openfiler 对两个主机（Oracle RAC 节点）进行<a href="http://www.oracle.com/technetwork/cn/articles/hunter-rac11gr2-iscsi-083834-zhs.html#Network_Access_Configuration">网络访问配置</a>
。这两个节点需要通过存储（专用）网络访问新的 iSCSI 目标。现在，我们需要授予这两个 Oracle RAC 节点访问新 iSCSI 目标的权限。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">单击名为“Network ACL”的灰色子选项卡（在“LUN Mapping”子选项卡旁）。对当前的 iSCSI 目标，将两个主机的“Access”值由“Deny”更改为“Allow”，然后单击“Update”按钮。 </span>
<span style="font-size: small;">
<span>
<span><img src="http://www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/120190.gif" alt=" "><br></span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">返回到创建新的目标 IQN
 一节，对其余两个 ISCSI 逻辑卷执行这三个任务，同时替换“iSCSI 目标/逻辑卷映射
”表中找到的值。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><span class="parahead1"><span>在 Oracle RAC 节点上配置 iSCSI 卷</span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">在集群中的两个 Oracle RAC 节点上配置 iSCSI 启动器。而创建分区只应在 RAC 集群的一个节点上执行。
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">iSCSI 客户端可以是提供 iSCSI 支持（驱动程序）的任何系统（Linux、Unix、MS Windows、Apple Mac 等）。在我们的示例中，客户端是两个 Linux 服务器（<tt>racnode1</tt>
 和                           <tt>racnode2</tt>
），它们运行的是 Oracle Enterprise Linux 5.4。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">在本节中，我们将在两个 Oracle RAC 节点上配置 iSCSI 软件启动器。Oracle Enterprise Linux 5.4 包括                           Open-iSCSI
 iSCSI 软件启动器，该软件启动器位于                           <tt>iscsi-initiator-utils</tt>
 RPM 中。这是对早期版本 Oracle Enterprise Linux (4.x) 的一个更改，这些早期版本中包含作为 
Linux-iSCSI 项目的一部分而开发的 Linux iscsi-sfnet 软件驱动程序。所有 iSCSI 管理任务（如发现和登录）将使用
 Open-iSCSI 中包含的命令行接口                           <tt>iscsiadm</tt>
。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">iSCSI 软件启动器将配置为自动登录网络存储服务器 (<tt>openfiler1</tt>
)，并<em>发现</em>
 上一节中创建的 iSCSI 卷。之后，我们将逐步使用                           <tt>udev</tt>
 为发现的每个 iSCSI 目标名称创建永久性本地 SCSI 设备名称（即                           <code>/dev/iscsi/crs1</code>
）。拥有一致的本地 SCSI 设备名称及其映射到的 iSCSI 目标，有助于在配置 ASM 时能够区分三个卷。但是，在此之前，我们首先必须安装 iSCSI 启动器软件。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><strong>安装 iSCSI（启动器）服务</strong>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">就 Oracle Enterprise Linux 5.4 来说，默认情况下不会安装 Open-iSCSI iSCSI 软件启动器。该软件包含在 1 号 CD 上的                           <tt>iscsi-initiator-utils</tt>
 程序包中。要确定该程序包是否已安装（大多数情况下没有安装），在两个 Oracle RAC 节点上执行以下命令：</span>
</p>
<p style="text-align: left;"><span style="color: #008000; font-size: small;">[root@racnode1 ~]# rpm -qa --queryformat "%{NAME}-%{VERSION}-%{RELEASE} (%{ARCH})\n"| grep iscsi-initiator-utils</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">如果                           <tt>iscsi-initiator-utils</tt>
 程序包未安装，将 1 号 CD 加载到每个 Oracle RAC 节点中并执行以下命令</span>
</p>
<p style="text-align: left;"><span style="color: #008000; font-size: small;">[root@racnode1 ~]# mount -r /dev/cdrom /media/cdrom<br>
[root@racnode1 ~]# cd /media/cdrom/Server<br>
[root@racnode1 ~]# rpm -Uvh iscsi-initiator-utils-*<br>
[root@racnode1 ~]# cd /<br>
[root@racnode1 ~]# eject</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">确认                           <tt>iscsi-initiator-utils</tt>
 程序包现在已安装：</span>
</p>
<p><span style="color: #008000; font-size: small;">[root@racnode1 ~]# rpm -qa --queryformat "%{NAME}-%{VERSION}-%{RELEASE} (%{ARCH})\n"| grep iscsi-initiator-utils<br>
iscsi-initiator-utils-6.2.0.871-0.10.el5 (x86_64)   </span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><strong>配置 iSCSI（启动器）服务</strong>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">验证                           <tt>iscsi-initiator-utils</tt>
 程序包已经安装到两个 Oracle RAC 节点之后，启动                           <tt>iscsid</tt>
 服务，并使其在系统引导时自动启动。我们还将配置                           <tt>iscsi</tt>
 服务在系统启动时自动启动，自动登录到所需的 iSCSI 目标。</span>
</p>
<p style="text-align: left;"><span style="color: #008000; font-size: small;">[root@racnode1 ~]# service iscsid start<br>
Turning off network shutdown. Starting iSCSI daemon: [ OK]<br>
 [ OK ]<br>
[root@racnode1 ~]# chkconfig iscsid on<br></span>
</p>
<p><span style="color: #008000; font-size: small;">[root@racnode1 ~]# chkconfig iscsi on</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">现在 iSCSI 服务已经启动，下面使用                           <tt>iscsiadm</tt>
 命令行接口发现网络存储服务器上的所有可用目标。这应该在两个 Oracle RAC 节点上执行，以检验配置是否正常工作：</span>
</p>
<p><span style="font-size: small;"><span style="font-family: Courier New;"><span style="color: #008000;">[root@racnode1 ~]# iscsiadm -m discovery -t sendtargets -p openfiler1-priv<br>
192.168.2.195:3260,1 iqn.2006-01.com.openfiler:racdb.crs1<br>
192.168.2.195:3260,1 iqn.2006-01.com.openfiler:racdb.fra1<br>
192.168.2.195:3260,1 iqn.2006-01.com.openfiler:racdb.data1</span>
</span>
</span>
</p>
<p> </p>
<p style="text-align: left;"><span style="font-size: small;"><strong>手动登录到 iSCSI 目标</strong>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">此时，iSCSI 启动器服务已经启动，每个 Oracle RAC 节点都能够从网络存储服务器中发现可用目标。下一步是手动登录每个可用目标，这可以使用                           <tt>iscsiadm</tt>
 命令行接口完成。这需要在两个 Oracle RAC 节点上运行。注意，我必须指定网络存储服务器的 IP 地址而非其主机名 (<tt>openfiler1-priv</tt>
) — 我认为必须这么做，因为上述发现使用 IP 地址显示目标。</span>
</p>
<p style="text-align: left;"><span style="color: #008000; font-size: small;">[root@racnode1 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:racdb.crs1 -p 192.168.2.195 -l<br>
[root@racnode1 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:racdb.data1 -p 192.168.2.195 -l<br>
[root@racnode1 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:racdb.fra1 -p 192.168.2.195 -l   </span>
<span style="font-size: small;"><br></span>
</p>
<p style="text-align: left;"><span style="font-size: small;">如果此时更新了openfiler服务器上的资源配置，可以使用如下命令更新相关配置</span>
</p>
<p style="text-align: left;"><span style="color: #008000; font-size: small;">iscsiadm -m node -T iqn.2006-01.com.openfiler:RACDBcrs1 -p 192.168.0.201 -R</span>
<span style="font-size: small;">
<span>
<span><br></span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><strong>配置自动登录</strong>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">下一步是确保在计算机引导（或 iSCSI 启动器服务启动/重启）时，客户端将自动登录到上面列出的每个目标。如同上面描述的手动登录过程，在两个 Oracle RAC 节点上执行以下命令：</span>
</p>
<p><span style="color: #008000; font-size: small;">[root@racnode1 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:racdb.crs1 -p 192.168.2.195 --op update -n node.startup -v automatic<br>
[root@racnode1 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:racdb.data1 -p 192.168.2.195 --op update -n node.startup -v automatic<br>
[root@racnode1 ~]# iscsiadm -m node -T iqn.2006-01.com.openfiler:racdb.fra1 -p 192.168.2.195 --op update -n node.startup -v automatic      </span>
</p>
<p style="text-align: left;"><span style="font-size: small;"><strong>创建永久性本地 SCSI 设备名称</strong>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">在本节中，我们将逐步为每个 iSCSI 目标名称创建永久性本地 SCSI 设备名称。我们将使用                           <tt>udev</tt>
 来完成该任务。拥有一致的本地 SCSI 设备名称及其映射到的 iSCSI 目标，有助于在配置 ASM 时能够区分三个卷。尽管并未严格要求这么做（因为我们将对所有卷使用                           ASMLib 2.0
），这提供了一种自我文档编制的方法，有助于快速确定每个 iSCSI 卷的名称和位置。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">如果任一 Oracle RAC 节点引导并且 iSCSI 启动器服务启动，它会以一种随机的方式自动登录到配置的每个目标，并将这些目标映射到下一个可用的本地 SCSI 设备名称。例如，目标                           <tt>iqn.2006-01.com.openfiler:racdb.crs1</tt>
 可能会映射到                           <tt>/dev/sdb</tt>
。实际上，我可以通过查看                           <tt>/dev/disk/by-path</tt>
 目录来确定所有目标的当前映射：</span>
</p>
<p><span style="color: #008000; font-size: small;">[root@racnode1 ~]# (cd /dev/disk/by-path; ls -l *openfiler* | awk '{FS=" "; <br>
print $9 " " $10 " " $11}')<br>
ip-192.168.2.195:3260-iscsi-iqn.2006-01.com.openfiler:racdb.crs1-lun-0 -&gt; ../../sdb<br>
ip-192.168.2.195:3260-iscsi-iqn.2006-01.com.openfiler:racdb.data1-lun-0 -&gt; ../../sdd<br>
ip-192.168.2.195:3260-iscsi-iqn.2006-01.com.openfiler:racdb.fra1-lun-0 -&gt; ../../sdc</span>
</p>
<p><span style="font-family: Courier New; font-size: small;">
    </span>
</p>
<p style="text-align: left;"><span style="font-size: small;">使用上述 ls 命令的输出结果，我们可以建立以下当前映射：</span>
</p>
<table cellspacing="1" border="1" style="text-align: left;" cellpadding="3">
<tr>
<td>
<span style="font-size: small;"><strong>iSCSI 目标名称到本地 SCSI 设备名称的当前映射</strong>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><strong>iSCSI 目标名称</strong>
</span>
</td>
<td>
<span style="font-size: small;"><strong>SCSI 设备名称</strong>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;">iqn.2006-01.com.openfiler:racdb.crs1</span>
</td>
<td>
<span style="font-size: small;"><tt>/dev/sdb</tt>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;">iqn.2006-01.com.openfiler:racdb.data1</span>
</td>
<td>
<span style="font-size: small;"><tt>/dev/sdd</tt>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;">iqn.2006-01.com.openfiler:racdb.fra1</span>
</td>
<td>
<span style="font-size: small;"><tt>/dev/sdc</tt>
</span>
</td>
</tr>
</table>
<p style="text-align: left;"><span style="font-size: small;">但是，每次重新引导 Oracle RAC 节点时，该映射都可能有所不同。例如，重新引导之后，可能会决定将 iSCSI 目标                           <tt>iqn.2006-01.com.openfiler:racdb.crs1</tt>
 映射到本地 SCSI 设备                           <tt>/dev/sdc</tt>
。由于您无法预测重新引导后的 iSCSI 目标映射，依赖于使用本地 SCSI 设备名称是不现实的。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">我们需要的是可引用的一致的设备名称（即                           <tt>/dev/iscsi/crs1</tt>
），该设备名称在重新引导后将始终指向相应的 iSCSI 目标。这就是引入名为                           <tt>udev</tt>
 的<em>动态设备管理</em>
 工具的原因。                         <tt>udev</tt>
 提供了一个动态设备目录，使用一组可配置的规则通过符号链接指向实际设备。当                           <tt>udev</tt>
 收到设备事件（例如，客户端登录到 iSCSI 目标）时，就会根据                           <em>sysfs</em>
 中提供的可用设备属性匹配其配置好的规则以便识别设备。匹配规则可以提供其他设备信息或指定设备节点名和多个符号链接名，并指示                           <tt>udev</tt>
 运行其他程序（例如，一个 SHELL 脚本）作为设备事件处理过程的一部分。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">第一步是创建一个新的<em>规则文件</em>
。该文件将命名为                           <tt>/etc/udev/rules.d/55-openiscsi.rules</tt>
，并且只包含一行用于接收我们感兴趣事件的名称=值对。它还将定义一个调出 SHELL 脚本 (<tt>/etc/udev/scripts/iscsidev.sh</tt>
)，用于处理事件。</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">在两个 Oracle RAC 节点上创建以下规则文件                           <tt>/etc/udev/rules.d/55-openiscsi.rules</tt>
：</span>
</p>
<p><span style="font-family: Courier New; font-size: small;"><span style="color: #008000;"># /etc/udev/rules.d/55-openiscsi.rules
</span>
</span>
</p>
<p><span style="font-family: Courier New; font-size: small;"><span style="color: #008000;">KERNEL=="sd*", BUS=="scsi", PROGRAM="/etc/udev/scripts/iscsidev.sh %b",
SYMLINK+="iscsi/%c/part%n"</span>
</span>
</p>
<p><span style="font-family: Courier New; font-size: small;">
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">现在，我们需要创建在接收该事件时将调用的 UNIX SHELL 脚本。我们首先在两个 Oracle RAC 节点上创建一个单独的目录，用于存储                           <tt>udev</tt>
 脚本：</span>
</p>
<p><span style="font-family: Courier New; color: #008000; font-size: small;">[root@racnode1 ~]# mkdir -p /etc/udev/scripts
            </span>
</p>
<p style="text-align: left;"><span style="font-size: small;">接下来，在两个 Oracle RAC 节点上创建 UNIX shell 脚本                           <tt>/etc/udev/scripts/iscsidev.sh</tt>
：</span>
</p>
<p><span style="color: #008000; font-size: small;"><span><span style="font-family: Courier New;">#!/bin/sh<br>
 # FILE: /etc/udev/scripts/iscsidev.sh<br><br>
BUS=${1}<br>
HOST=${BUS%%:*}<br>
 [ -e /sys/class/iscsi_host ] || exit 1<br>
file="/sys/class/iscsi_host/host${HOST}/device/session*/iscsi_session*/<br>
targetname"<br>
target_name=$(cat ${file})<br>
# This is not an open-scsi drive<br>
if [ -z "${target_name}" ]; then<br>
   exit 1<br>
fi<br><br>
# Check if QNAP drive<br>
check_qnap_target_name=${target_name%%:*}<br>
if [ $check_qnap_target_name = "iqn.2004-04.com.qnap" ]; then<br>
    target_name=`echo "${target_name%.*}"`<br>
fi<br><br>
echo "${target_name##*.}"</span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">创建 UNIX SHELL 脚本后，将其更改为可执行文件：</span>
</p>
<p><span style="font-family: Courier New; color: #008000; font-size: small;"> [root@racnode1 ~]# <strong>chmod 755 /etc/udev/scripts/iscsidev.sh</strong>
</span>
</p>
<p><span style="font-family: Courier New; color: #008000; font-size: small;">
               </span>
</p>
<p><span style="font-size: small;">既然已经配置了                           <tt>udev</tt>
，下面将在两个 Oracle RAC 节点上重新启动 iSCSI 服务：</span>
</p>
<p><span style="color: #008000; font-size: small;">[root@racnode1 ~]# service iscsi stop<br>
Logging out of session [sid: 6, target: iqn.2006-01.com.openfiler:racdb.crs1, portal: 192.168.2.195,3260]<br>
Logging out of session [sid: 7, target: iqn.2006-01.com.openfiler:racdb.fra1, portal: 192.168.2.195,3260]<br>
Logging out of session [sid: 8, target: iqn.2006-01.com.openfiler:racdb.data1, portal: 192.168.2.195,3260]<br>
Logout of [sid: 6, target: iqn.2006-01.com.openfiler:racdb.crs1, portal: 192.168.2.195,3260]: successful<br>
Logout of [sid: 7, target: iqn.2006-01.com.openfiler:racdb.fra1, portal: 192.168.2.195,3260]: successful<br>
Logout of [sid: 8, target: iqn.2006-01.com.openfiler:racdb.data1, portal: 192.168.2.195,3260]: successful<br>
Stopping iSCSI daemon:                               [ OK ]<br>
[root@racnode1 ~]# service iscsi start<br>
iscsid dead but pid file exists<br>
Turning off network shutdown. Starting iSCSI daemon: [ OK ]<br>
                                                     [ OK ]<br>
Setting up iSCSI targets: Logging in to [iface: default, target: iqn.2006-01.com.openfiler:racdb.crs1, portal: 192.168.2.195,3260]<br>
Logging in to [iface: default, target: iqn.2006-01.com.openfiler:racdb.fra1, portal: 192.168.2.195,3260]<br>
Logging in to [iface: default, target: iqn.2006-01.com.openfiler:racdb.data1, portal: 192.168.2.195,3260]<br>
Login to [iface: default, target: iqn.2006-01.com.openfiler:racdb.crs1, portal: 192.168.2.195,3260]: successful<br>
Login to [iface: default, target: iqn.2006-01.com.openfiler:racdb.fra1, portal: 192.168.2.195,3260]: successful<br>
Login to [iface: default, target: iqn.2006-01.com.openfiler:racdb.data1, portal: 192.168.2.195,3260]: successful [ OK ]</span>
</p>
<p>
<span style="font-family: Courier New; font-size: small;">
</span>
</p>
<p><span style="font-size: small;">下面，我们来看一下我们的辛勤工作是否得到了回报：</span>
</p>
<p><span style="color: #008000; font-size: small;">[root@racnode1 ~]# ls -l /dev/iscsi/*<br>
/dev/iscsi/crs1:<br>
total 0<br>
lrwxrwxrwx 1 root root 9 Nov  3 18:13 part -&gt; ../../sdc<br>
/dev/iscsi/data1:<br>
total 0<br>
lrwxrwxrwx 1 root root 9 Nov  3 18:13 part -&gt; ../../sde<br>
/dev/iscsi/fra1:<br>
total 0<br>
lrwxrwxrwx 1 root root 9 Nov  3 18:13 part -&gt; ../../sdd</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">上面的清单显示，                         <tt>udev</tt>
 所做的工作正是我们所期待的!现在，我们拥有了一组一致的本地设备名称，可用于引用 iSCSI 目标。例如，我们可以安全地认为设备名称                           <tt>/dev/iscsi/crs1/part</tt>
 将始终引用 iSCSI 目标                           <tt>iqn.2006-01.com.openfiler:racdb.crs1</tt>
。现在，我们拥有了一致的 iSCSI 目标名称到本地设备名称的映射，如下表所示：</span>
</p>
<table cellspacing="1" border="1" style="text-align: left;" cellpadding="3">
<tr>
<td>
<span style="font-size: small;"><strong>iSCSI 目标名称到本地设备名称的映射</strong>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><strong>iSCSI 目标名称</strong>
</span>
</td>
<td>
<span style="font-size: small;"><strong>本地设备名称</strong>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><tt>iqn.2006-01.com.openfiler:racdb.crs1</tt>
</span>
</td>
<td>
<span style="font-size: small;"><tt>/dev/iscsi/crs1/part</tt>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><tt>iqn.2006-01.com.openfiler:racdb.data1</tt>
</span>
</td>
<td>
<span style="font-size: small;"><tt>/dev/iscsi/data1/part</tt>
</span>
</td>
</tr>
<tr>
<td>
<span style="font-size: small;"><tt>iqn.2006-01.com.openfiler:racdb.fra1</tt>
</span>
</td>
<td>
<span style="font-size: small;"><tt>/dev/iscsi/fra1/part</tt>
</span>
</td>
</tr>
</table>
<p style="text-align: left;"><span style="font-size: small;"><br></span>
</p>
<p style="text-align: left;"><span style="font-size: small;">参考至：http://www.oracle.com/technetwork/cn/articles/hunter-rac11gr2-iscsi-083834-zhs.html#Network_Access_Configuration<br>
             http://jeremiah.blog.51cto.com/539865/278107<br></span>
<span style="font-size: small;">
<span>
<span><span>             </span>
http://baike.baidu.com/view/120148.htm</span>
</span>
</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">本文原创，转载请注明出处、作者<br>
如有错误，欢迎指正</span>
</p>
<p style="text-align: left;"><span style="font-size: small;">邮箱:czmcj@163.com<br></span>
</p>
  </div>

  


  
  
  <div id="bottoms" class="clearfix">
    <div id="digg_bottom" class="clearfix"><div class='digged'><strong>0</strong> <br/>顶</div><div class='digged'><strong>1</strong> <br/>踩</div></div>
    <div id="share_weibo">分享到：
      <a data-type='sina' href="javascript:;" title="分享到新浪微博"><img src="/images/sina.jpg"></a>
      <a data-type='qq' href="javascript:;" title="分享到腾讯微博"><img src="/images/tec.jpg"></a>
    </div>
  </div>

  <div class="blog_nav">
    <div class="pre_next">
      <a href="/blog/1735773" class="next" title="RAC FAILover详解(原创)">RAC FAILover详解(原创)</a>
      |
      <a href="/blog/1734783" class="pre" title="ORA-15063: ASM discovered an insufficient number of disks for diskgroup(原创)">ORA-15063: ASM discovered an insufficien ...</a>
    </div>
  </div>
  <div class="blog_bottom">
    <ul>
      <li>2012-11-26 15:42</li>
      <li>浏览 2318</li>
      <li><a href="#comments">评论(0)</a></li>
      
      
      <li>分类:<a href="http://www.iteye.com/blogs/category/os">操作系统</a></li>      
      <li class='last'><a href="http://www.iteye.com/wiki/blog/1735417" target="_blank" class="more">相关推荐</a></li>
    </ul>
  </div>

  <div class="blog_comment">
    <h5>评论</h5>
    <a id="comments" name="comments"></a>
    
    
    
  </div>

  <div class="blog_comment">
    <h5>发表评论</h5>
            <p style="text-align:center; margin-top:30px;margin-bottom:0px;"><a href="/login" style="background-color:white;"> <img src="/images/login_icon.png" style="vertical-align:middle; margin-right: 10px;" /></a><a href="/login">  您还没有登录,请您登录后再发表评论 </a></p>
      </div>
</div>


<script type="text/javascript">
  dp.SyntaxHighlighter.HighlightAll('code', true, true);

  $$('#main .blog_content pre[name=code]').each(function(pre, index){ // blog content
    var post_id = 1735417;
    var location = window.location;
    source_url = location.protocol + "//" + location.host + location.pathname + location.search;
    pre.writeAttribute('codeable_id', post_id);
    pre.writeAttribute('codeable_type', "Blog");
    pre.writeAttribute('source_url', source_url);
    pre.writeAttribute('pre_index', index);
    pre.writeAttribute('title', '利用openfiler实现iSCSI(原创)');
  });

  fix_image_size($$('div.blog_content img'), 700);

  function processComment() {
    $$('#main .blog_comment > div').each(function(comment){// comment
      var post_id = comment.id.substr(2);
      $$("#"+comment.id+" pre[name=code]").each(function(pre, index){
        var location = window.location;
        source_url = location.protocol + "//" + location.host + location.pathname + location.search;
        source_url += "#" + comment.id;
        pre.writeAttribute('codeable_id', post_id);
        pre.writeAttribute('codeable_type', "BlogComment");
        pre.writeAttribute('source_url', source_url);
        pre.writeAttribute('pre_index', index);
        pre.writeAttribute('title', '利用openfiler实现iSCSI(原创)');
      });
    });
  }

  function quote_comment(id) {
    new Ajax.Request('/editor/quote', {
      parameters: {'id':id, 'type':'BlogComment'},
      onSuccess:function(response){editor.bbcode_editor.textarea.insertAfterSelection(response.responseText);
        Element.scrollTo(editor.bbcode_editor.textarea.element);}
    });
  }

  code_favorites_init();
  processComment();
  new WeiboShare({share_buttons: $('share_weibo'), img_scope: $('blog_content')});
</script>




        </div>

        <div id="local">
          <div class="local_top"></div>
          <div id="blog_owner">
  <div id="blog_owner_logo"><a href='http://czmmiao.iteye.com'><img alt="czmmiao的博客" class="logo" src="http://www.iteye.com/upload/logo/user/570797/c6897931-33fe-394d-9192-3fd18bad1dfd.jpg?1318687223" title="czmmiao的博客: CzmMiao的博客生活" /></a></div>
  <div id="blog_owner_name">czmmiao</div>
</div>

          <div id="blog_actions">
            <ul>
              <li>浏览: 377117 次</li>
              <li>性别: <img alt="Icon_minigender_1" src="http://www.iteye.com/images/icon_minigender_1.gif?1324994303" title="男" /></li>
              <li>来自: 厦门</li>
              <li><img src='/images/status/offline.gif'/></li>
              
            </ul>
          </div>
          <div id="user_visits" class="clearfix">
            <h5>最近访客 <span style='font-weight:normal;font-size:12px;padding-left:30px;'><a href="/blog/user_visits">更多访客&gt;&gt;</a></span></h5>
            
              <div class="user_visit">
                <div class="logo"><a href='http://byh6666.iteye.com' target='_blank'><img alt="byh6666的博客" class="logo" src="http://www.iteye.com/images/user-logo-thumb.gif?1324994303" title="byh6666的博客: byh6666" /></a></div>
                <div class="left"><a href='http://byh6666.iteye.com' target='_blank' title='byh6666'>byh6666</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href='http://lijunxian0114.iteye.com' target='_blank'><img alt="lijunxian0114的博客" class="logo" src="http://www.iteye.com/images/user-logo-thumb.gif?1324994303" title="lijunxian0114的博客: " /></a></div>
                <div class="left"><a href='http://lijunxian0114.iteye.com' target='_blank' title='lijunxian0114'>lijunxian0114</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href='http://linvar.iteye.com' target='_blank'><img alt="linvar的博客" class="logo" src="http://www.iteye.com/upload/logo/user/201800/704c5198-5cfa-3b11-933e-6c158ff13c8d-thumb.jpg?1265073312" title="linvar的博客: linvar" /></a></div>
                <div class="left"><a href='http://linvar.iteye.com' target='_blank' title='linvar'>linvar</a></div>
              </div>
            
              <div class="user_visit">
                <div class="logo"><a href='http://dylinshi126.iteye.com' target='_blank'><img alt="dylinshi126的博客" class="logo" src="http://www.iteye.com/images/user-logo-thumb.gif?1324994303" title="dylinshi126的博客: " /></a></div>
                <div class="left"><a href='http://dylinshi126.iteye.com' target='_blank' title='dylinshi126'>dylinshi126</a></div>
              </div>
            
          </div>

          

                      <div id="blog_menu">
              <h5>文章分类</h5>
              <ul>
                <li><a href="/">全部博客 (430)</a></li>
                
                  <li><a href="/category/192591">Oracle日常管理 (79)</a></li>
                
                  <li><a href="/category/143940">Oracle体系架构 (33)</a></li>
                
                  <li><a href="/category/212693">Oracle Tuning (30)</a></li>
                
                  <li><a href="/category/143942">Oracle故障诊断 (34)</a></li>
                
                  <li><a href="/category/198476">RAC/DG/OGG (37)</a></li>
                
                  <li><a href="/category/293960">Oracle11g New Features (45)</a></li>
                
                  <li><a href="/category/263856">DataWarehouse (6)</a></li>
                
                  <li><a href="/category/267464">PL/SQL (13)</a></li>
                
                  <li><a href="/category/198031">DB2日常管理 (9)</a></li>
                
                  <li><a href="/category/235855">Weblogic (11)</a></li>
                
                  <li><a href="/category/143943">Shell (19)</a></li>
                
                  <li><a href="/category/168842">AIX (12)</a></li>
                
                  <li><a href="/category/178145">Linux/Unix高可用性 (11)</a></li>
                
                  <li><a href="/category/143957">Linux/Unix日常管理 (50)</a></li>
                
                  <li><a href="/category/143941">Linux桌面应用 (27)</a></li>
                
                  <li><a href="/category/295220">Windows (2)</a></li>
                
                  <li><a href="/category/143945">生活和工作 (13)</a></li>
                
                  <li><a href="/category/143944">私人记事 (0)</a></li>
                
              </ul>
            </div>
            <div id='month_blogs'>
              <h5>社区版块</h5>
              <ul>
                <li><a href="/blog/news">我的资讯</a> (0)</li>
                <li>
                  <a href="/blog/post">我的论坛</a> (2)
                </li>
                <li><a href="/blog/answered_problems">我的问答</a> (56)</li>
              </ul>
            </div>
            <div id="month_blogs">
              <h5>存档分类</h5>
              <ul>
                
                  <li><a href="/blog/monthblog/2013-12">2013-12</a> (4)</li>
                
                  <li><a href="/blog/monthblog/2013-11">2013-11</a> (9)</li>
                
                  <li><a href="/blog/monthblog/2013-10">2013-10</a> (35)</li>
                
                <li><a href="/blog/monthblog_more">更多存档...</a></li>
              </ul>
            </div>
            
            
              <div id="comments_top">
                <h5>评论排行榜</h5>
                <ul>
                  
                    <li><a href="/blog/1835953" title="ETL概述(原创)">ETL概述(原创)</a></li>
                  
                    <li><a href="/blog/1766442" title="latch: cache buffers chains故障处理总结(原创)">latch: cache buffers chains故障处理总结 ...</a></li>
                  
                    <li><a href="/blog/1807571" title="Oracle的Filter,Nest loop,Merge sort join和Hash join(原创)">Oracle的Filter,Nest loop,Merge sort join ...</a></li>
                  
                    <li><a href="/blog/1815000" title="PL/SQL的存储过程和函数(原创)">PL/SQL的存储过程和函数(原创)</a></li>
                  
                </ul>
              </div>
            

            <div id="guest_books">
              <h5>最新评论</h5>
              <ul>
                
                <li>
                  <a href='http://di1984hit.iteye.com' target='_blank' title='di1984HIT'>di1984HIT</a>： 
                  鞋的很好啊<br />
                  <a href="/blog/1292412#bc2335679">DBA日常维护SQL整理(原创)</a>
                </li>
                
                <li>
                  <a href='http://201211105633.iteye.com' target='_blank' title='惢雨'>惢雨</a>： 
                  [align=left][/align][size=xx-sm ...<br />
                  <a href="/blog/1395575#bc2327925">db2与oracle不同的常用sql写法记录(原创)</a>
                </li>
                
                <li>
                  <a href='http://czmmiao.iteye.com' target='_blank' title='czmmiao'>czmmiao</a>： 
                  wu8467937 写道和我的经历非常非常像啊，你现在在广州哪 ...<br />
                  <a href="/blog/1732669#bc2326859">工作大事记(原创)</a>
                </li>
                
                <li>
                  <a href='http://wu8467937.iteye.com' target='_blank' title='wu8467937'>wu8467937</a>： 
                  和我的经历非常非常像啊，你现在在广州哪里，我也是这个月刚刚到广 ...<br />
                  <a href="/blog/1732669#bc2326847">工作大事记(原创)</a>
                </li>
                
                <li>
                  <a href='http://zhachunling.iteye.com' target='_blank' title='zhachunling'>zhachunling</a>： 
                  写的很好,<br />
                  <a href="/blog/1807571#bc2313576">Oracle的Filter,Nest loop,Merge sort join和Hash join(原创)</a>
                </li>
                
              </ul>
            </div>

            <div class="local_bottom"></div>
          
        </div>
      </div>

      <div id="footer" class="clearfix">
        <div id="copyright">
          <hr/>
          声明：ITeye文章版权属于作者，受法律保护。没有作者书面许可不得转载。若作者同意转载，必须以超链接形式标明文章原始出处和作者。<br />
          &copy; 2003-2012 ITeye.com.   All rights reserved.  [ 京ICP证110151号  京公网安备110105010620 ]
        </div>
      </div>
    </div>
    <script type="text/javascript">
  document.write("<img src='http://stat.iteye.com/?url="+ encodeURIComponent(document.location.href) + "&referrer=" + encodeURIComponent(document.referrer) + "&user_id=' width='0' height='0' />");
</script>

<script src="http://csdnimg.cn/pubfooter/js/tracking.js?version=20130923164150" type="text/javascript"></script>

    
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'zhimin.chen@zznode.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
      
    
  </body>
</html>
